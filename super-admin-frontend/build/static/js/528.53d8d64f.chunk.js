"use strict";(self.webpackChunkeduvault_super_admin_frontend=self.webpackChunkeduvault_super_admin_frontend||[]).push([[528],{8528:(e,t,n)=>{n.r(t),n.d(t,{default:()=>je});var i=n(8),o=n(9950),s=n(9808),a=n(6491),r=n(6639),l=n(2053),c=n(5333),d=n(4447),u=n(2236),h=n(4142),x=n(899),m=n(470),v=n(704),p=n(226),A=n(1413),j=n(9925),y=n(6387),g=n(9086),b=n(9240),f=n(9238),w=n(6299),C=n(6812),S=n(3553),I=n(9715),k=n(1543),U=n(5926),N=n(3174),D=n(5277),R=n(3464),E=n(33),T=n(8170),_=n(9739),L=n(975),P=n(957),B=n(8785),F=n(3505),W=n(8629),M=n(8517),O=n(8179),H=n(3759),z=n(6835),V=n(760),K=n(6724),G=n(8267),Y=n(3935),J=n(6191),q=n(5699),Q=n(4414);const X=()=>{var e,t,n,c,d,u,h,y,g,b,f,w,C,S,I,k,X,Z,$,ee,te,ne,ie,oe,se,ae,re,le,ce,de,ue,he,xe;const[me,ve]=(0,o.useState)(!0),[pe,Ae]=(0,o.useState)(null),[je,ye]=(0,o.useState)([]),[ge,be]=(0,o.useState)({pending:0,approved:0,rejected:0}),[fe,we]=(0,o.useState)({open:!1,content:null}),[Ce,Se]=(0,o.useState)({open:!1,content:null,action:null}),[Ie,ke]=(0,o.useState)({open:!1,content:null}),[Ue,Ne]=(0,o.useState)(""),[De,Re]=(0,o.useState)(!1),[Ee,Te]=(0,o.useState)({open:!1,message:"",severity:"success"});(0,o.useEffect)(()=>{_e()},[]);const _e=async()=>{try{ve(!0),Ae(null);const e=(await U.A.get("/api/content-approval/pending")).data.pendingContent||[];console.log("\ud83d\udccb Fetched pending content:",e),ye(e),be({pending:e.length,approved:0,rejected:0}),0===e.length&&Ae("No pending content found. All content has been reviewed!")}catch(pe){console.error("Error fetching pending content:",pe),Ae("Failed to fetch pending content. Please check your connection."),ye([]),be({pending:0,approved:0,rejected:0})}finally{ve(!1)}},Le=e=>{switch(e){case"video":return(0,Q.jsx)(F.A,{});case"notes":default:return(0,Q.jsx)(W.A,{});case"cats":case"assignments":case"pastExams":return(0,Q.jsx)(M.A,{})}},Pe=e=>{switch(e){case"video":return"error";case"notes":return"primary";case"cats":case"assignments":case"pastExams":return"warning";default:return"info"}},Be=(e,t)=>{Se({open:!0,content:e,action:t}),Ne(""),Re(!1)},Fe=e=>{var t,n;const i=(null===(t=e.content)||void 0===t?void 0:t.filePath)||(null===(n=e.content)||void 0===n?void 0:n.url);i?window.open("".concat("http://localhost:5001").concat(i),"_blank"):Te({open:!0,message:"File URL not available",severity:"error"})};return me?(0,Q.jsxs)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[(0,Q.jsx)(r.A,{}),(0,Q.jsx)(l.A,{variant:"h6",sx:{ml:2},children:"Loading pending content..."})]}):(0,Q.jsxs)(s.A,{maxWidth:"lg",children:[(0,Q.jsxs)(a.A,{sx:{mb:4},children:[(0,Q.jsx)(l.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:2},children:"\ud83d\udccb Content Approval"}),(0,Q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"Review and approve content uploaded by mini admins"})]}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"warning.main",color:"white"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ge.pending}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u23f3 Pending Review"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"success.main",color:"white"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ge.approved}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u2705 Approved"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"error.main",color:"white"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ge.rejected}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u274c Rejected"})]})})})]}),pe&&(0,Q.jsx)(N.A,{severity:0===je.length?"info":"error",sx:{mb:3},children:pe}),(0,Q.jsx)(x.Ay,{container:!0,spacing:3,children:je.map((e,t)=>{var n,i,o,s;return(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{sx:{border:1,borderColor:"divider"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Q.jsx)(A.A,{sx:{bgcolor:"".concat(Pe(e.type),".main"),color:"white"},children:Le(e.type)}),(0,Q.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,Q.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:e.topicTitle||(null===(n=e.content)||void 0===n?void 0:n.title)||"".concat(e.type.toUpperCase()," Content")}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcda Course: ",e.courseName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcd6 Unit: ",e.unitName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc1 File: ",(null===(i=e.content)||void 0===i?void 0:i.filename)||(null===(o=e.content)||void 0===o?void 0:o.originalName)||"Unknown file"]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udc64 Uploaded by: ",(null===(s=e.content)||void 0===s?void 0:s.uploadedBy)||"Unknown"]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc5 Upload date: ",new Date(e.uploadDate).toLocaleDateString()]})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Q.jsx)(D.A,{label:e.type.toUpperCase(),color:Pe(e.type),size:"small"}),(0,Q.jsx)(p.A,{size:"small",variant:"outlined",startIcon:(0,Q.jsx)(O.A,{}),onClick:()=>(e=>{we({open:!0,content:e})})(e),children:"Preview"}),(0,Q.jsx)(p.A,{size:"small",variant:"contained",color:"success",startIcon:(0,Q.jsx)(H.A,{}),onClick:()=>Be(e,"approve"),children:"Approve"}),(0,Q.jsx)(p.A,{size:"small",variant:"contained",color:"error",startIcon:(0,Q.jsx)(z.A,{}),onClick:()=>Be(e,"reject"),children:"Reject"}),(0,Q.jsx)(p.A,{size:"small",variant:"outlined",color:"error",startIcon:(0,Q.jsx)(V.A,{}),onClick:()=>(e=>{ke({open:!0,content:e})})(e),sx:{ml:1},children:"Delete"})]})]})})})},"".concat(e.courseId,"_").concat(e.unitId,"_").concat(e.topicId||e.assessmentId,"_").concat(t))})}),0===je.length&&!me&&(0,Q.jsxs)(a.A,{sx:{textAlign:"center",py:8},children:[(0,Q.jsx)(l.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"\ud83c\udf89 All caught up!"}),(0,Q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"No pending content to review at the moment."}),(0,Q.jsx)(p.A,{variant:"outlined",onClick:_e,sx:{mt:2},children:"Refresh"})]}),(0,Q.jsxs)(R.A,{open:fe.open,onClose:()=>we({open:!1,content:null}),maxWidth:"md",fullWidth:!0,children:[(0,Q.jsxs)(E.A,{children:["Content Preview: ",(null===(e=fe.content)||void 0===e?void 0:e.topicTitle)||(null===(t=fe.content)||void 0===t||null===(n=t.content)||void 0===n?void 0:n.title)]}),(0,Q.jsxs)(T.A,{children:[(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Type: ",null===(c=fe.content)||void 0===c||null===(d=c.type)||void 0===d?void 0:d.toUpperCase()]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["File: ",(null===(u=fe.content)||void 0===u||null===(h=u.content)||void 0===h?void 0:h.filename)||(null===(y=fe.content)||void 0===y||null===(g=y.content)||void 0===g?void 0:g.originalName)]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(b=fe.content)||void 0===b?void 0:b.courseName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(f=fe.content)||void 0===f?void 0:f.unitName]}),("cats"===(null===(w=fe.content)||void 0===w?void 0:w.type)||"assignments"===(null===(C=fe.content)||void 0===C?void 0:C.type)||"pastExams"===(null===(S=fe.content)||void 0===S?void 0:S.type))&&(null===(I=fe.content)||void 0===I||null===(k=I.content)||void 0===k?void 0:k.filePath)&&(0,Q.jsxs)(a.A,{sx:{mt:3},children:[(0,Q.jsx)(l.A,{variant:"subtitle2",sx:{mb:2},children:"\ud83d\udcf8 Assessment Image Preview:"}),(0,Q.jsxs)(a.A,{sx:{border:1,borderColor:"divider",borderRadius:1,p:2,textAlign:"center",bgcolor:"grey.50",maxHeight:"400px",overflow:"auto"},children:[(0,Q.jsx)("img",{src:"".concat("http://localhost:5001").concat(fe.content.content.filePath),alt:"Assessment Preview",style:{maxWidth:"100%",maxHeight:"350px",objectFit:"contain",borderRadius:"4px"},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{display:"none",mt:2},children:"\u274c Image preview not available"})]}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"\ud83d\udca1 Check image quality to determine if content should be marked as premium"})]}),(0,Q.jsxs)(a.A,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:["video"===(null===(X=fe.content)||void 0===X?void 0:X.type)&&(0,Q.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,Q.jsx)(K.A,{}),onClick:()=>Fe(fe.content),children:"Play Video"}),"notes"===(null===(Z=fe.content)||void 0===Z?void 0:Z.type)&&(0,Q.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,Q.jsx)(G.A,{}),onClick:()=>Fe(fe.content),children:"View PDF"}),("cats"===(null===($=fe.content)||void 0===$?void 0:$.type)||"assignments"===(null===(ee=fe.content)||void 0===ee?void 0:ee.type)||"pastExams"===(null===(te=fe.content)||void 0===te?void 0:te.type))&&(0,Q.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,Q.jsx)(M.A,{}),onClick:()=>Fe(fe.content),children:"View Assessment"}),(0,Q.jsx)(p.A,{variant:"outlined",startIcon:(0,Q.jsx)(Y.A,{}),onClick:()=>(async e=>{try{var t,n,i,o;const s=(null===(t=e.content)||void 0===t?void 0:t.filePath)||(null===(n=e.content)||void 0===n?void 0:n.url);if(!s)throw new Error("File URL not available");const a=await U.A.get("".concat(s),{responseType:"blob"}),r=new Blob([a.data]),l=window.URL.createObjectURL(r),c=document.createElement("a");c.href=l,c.download=(null===(i=e.content)||void 0===i?void 0:i.filename)||(null===(o=e.content)||void 0===o?void 0:o.originalName)||"download",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),Te({open:!0,message:"File downloaded successfully",severity:"success"})}catch(pe){console.error("Download error:",pe),Te({open:!0,message:"Failed to download file",severity:"error"})}})(fe.content),children:"Download File"})]})]}),(0,Q.jsxs)(_.A,{children:[(0,Q.jsx)(p.A,{variant:"contained",color:"success",startIcon:(0,Q.jsx)(H.A,{}),onClick:()=>{we({open:!1,content:null}),Be(fe.content,"approve")},children:"Approve"}),(0,Q.jsx)(p.A,{variant:"contained",color:"error",startIcon:(0,Q.jsx)(z.A,{}),onClick:()=>{we({open:!1,content:null}),Be(fe.content,"reject")},children:"Reject"}),(0,Q.jsx)(p.A,{onClick:()=>we({open:!1,content:null}),children:"Close"})]})]}),(0,Q.jsxs)(R.A,{open:Ce.open,onClose:()=>Se({open:!1,content:null,action:null}),maxWidth:"sm",fullWidth:!0,children:[(0,Q.jsxs)(E.A,{children:["approve"===Ce.action?"Approve":"Reject"," Content"]}),(0,Q.jsxs)(T.A,{children:[(0,Q.jsxs)(l.A,{variant:"subtitle2",gutterBottom:!0,children:["Content: ",(null===(ne=Ce.content)||void 0===ne?void 0:ne.topicTitle)||(null===(ie=Ce.content)||void 0===ie||null===(oe=ie.content)||void 0===oe?void 0:oe.title)]}),"approve"===Ce.action&&(0,Q.jsx)(L.A,{control:(0,Q.jsx)(P.A,{checked:De,onChange:e=>Re(e.target.checked),color:"warning"}),label:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Q.jsx)(J.A,{color:De?"warning":"disabled"}),(0,Q.jsx)(l.A,{children:"Mark as Premium Content"})]}),sx:{mb:2}}),(0,Q.jsx)(j.A,{fullWidth:!0,multiline:!0,rows:4,label:"Review Notes",placeholder:"Add notes for ".concat(Ce.action,"ing this content..."),value:Ue,onChange:e=>Ne(e.target.value),variant:"outlined"})]}),(0,Q.jsxs)(_.A,{children:[(0,Q.jsx)(p.A,{onClick:()=>Se({open:!1,content:null,action:null}),children:"Cancel"}),(0,Q.jsx)(p.A,{variant:"contained",color:"approve"===Ce.action?"success":"error",onClick:async()=>{try{const{content:e,action:t}=Ce,n=(0,i.A)({courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type,reviewNotes:Ue},"approve"===t&&{isPremium:De}),o="approve"===t?"/api/content-approval/approve":"/api/content-approval/reject";await U.A.post(o,n),ye(t=>t.filter(t=>t.topicId!==e.topicId&&t.assessmentId!==e.assessmentId)),be(e=>(0,i.A)((0,i.A)({},e),{},{pending:Math.max(0,e.pending-1),["approve"===t?"approved":"rejected"]:e["approve"===t?"approved":"rejected"]+1})),Te({open:!0,message:"Content ".concat(t,"d successfully! ").concat(De&&"approve"===t?"\u2b50 Marked as Premium":""),severity:"success"}),Se({open:!1,content:null,action:null})}catch(pe){var e,t;console.error("Error submitting review:",pe),Te({open:!0,message:"Failed to ".concat(Ce.action," content: ").concat((null===(e=pe.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||pe.message),severity:"error"})}},startIcon:"approve"===Ce.action?(0,Q.jsx)(H.A,{}):(0,Q.jsx)(z.A,{}),children:"approve"===Ce.action?"Approve":"Reject"})]})]}),(0,Q.jsxs)(R.A,{open:Ie.open,onClose:()=>ke({open:!1,content:null}),maxWidth:"sm",fullWidth:!0,children:[(0,Q.jsxs)(E.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Q.jsx)(q.A,{color:"error"}),"Delete Content Permanently"]}),(0,Q.jsxs)(T.A,{children:[(0,Q.jsx)(l.A,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to permanently delete this content from the database?"}),(0,Q.jsxs)(l.A,{variant:"subtitle2",color:"error",gutterBottom:!0,children:["Content: ",(null===(se=Ie.content)||void 0===se?void 0:se.topicTitle)||(null===(ae=Ie.content)||void 0===ae||null===(re=ae.content)||void 0===re?void 0:re.title)]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(le=Ie.content)||void 0===le?void 0:le.courseName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(ce=Ie.content)||void 0===ce?void 0:ce.unitName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["File: ",(null===(de=Ie.content)||void 0===de||null===(ue=de.content)||void 0===ue?void 0:ue.filename)||(null===(he=Ie.content)||void 0===he||null===(xe=he.content)||void 0===xe?void 0:xe.originalName)]}),(0,Q.jsx)(N.A,{severity:"error",sx:{mt:2},children:"\u26a0\ufe0f This action cannot be undone! The content will be permanently removed from the database."})]}),(0,Q.jsxs)(_.A,{children:[(0,Q.jsx)(p.A,{onClick:()=>ke({open:!1,content:null}),children:"Cancel"}),(0,Q.jsx)(p.A,{variant:"contained",color:"error",onClick:async()=>{try{const e=Ie.content;await U.A.delete("/api/content-approval/delete",{data:{courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type}}),ye(t=>t.filter(t=>t.topicId!==e.topicId&&t.assessmentId!==e.assessmentId)),be(e=>(0,i.A)((0,i.A)({},e),{},{pending:Math.max(0,e.pending-1)})),Te({open:!0,message:"Content deleted successfully from database",severity:"success"}),ke({open:!1,content:null})}catch(pe){var e,t;console.error("Error deleting content:",pe),Te({open:!0,message:"Failed to delete content: ".concat((null===(e=pe.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||pe.message),severity:"error"})}},startIcon:(0,Q.jsx)(V.A,{}),children:"Delete Permanently"})]})]}),(0,Q.jsx)(B.A,{open:Ee.open,autoHideDuration:6e3,onClose:()=>Te((0,i.A)((0,i.A)({},Ee),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,Q.jsx)(N.A,{onClose:()=>Te((0,i.A)((0,i.A)({},Ee),{},{open:!1})),severity:Ee.severity,sx:{width:"100%"},children:Ee.message})})]})};var Z=n(7239),$=n(3266),ee=n(4745),te=n(6281),ne=n(9489),ie=n(379);const oe=()=>{var e,t,n,d,u,h,j,y,g,b,f,w,C,S,I,k,L,P,H,z;const[X,oe]=(0,o.useState)(!0),[se,ae]=(0,o.useState)(null),[re,le]=(0,o.useState)([]),[ce,de]=(0,o.useState)({approved:0,premium:0,total:0}),[ue,he]=(0,o.useState)({open:!1,content:null}),[xe,me]=(0,o.useState)({open:!1,content:null}),[ve,pe]=(0,o.useState)({open:!1,content:null}),[Ae,je]=(0,o.useState)(null),[ye,ge]=(0,o.useState)(null),[be,fe]=(0,o.useState)({open:!1,message:"",severity:"success"});(0,o.useEffect)(()=>{we()},[]);const we=async()=>{try{oe(!0),ae(null);const e=(await U.A.get("/api/content-approval/approved")).data.approvedContent||[];console.log("\ud83d\udccb Fetched approved content:",e),le(e);const t=e.filter(e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.isPremium}).length;de({approved:e.length,premium:t,total:e.length}),0===e.length&&ae("No approved content found.")}catch(se){console.error("Error fetching approved content:",se),ae("Failed to fetch approved content. Please check your connection."),le([]),de({approved:0,premium:0,total:0})}finally{oe(!1)}},Ce=e=>{switch(e){case"video":return(0,Q.jsx)(F.A,{});case"notes":default:return(0,Q.jsx)(W.A,{});case"cats":case"assignments":case"pastExams":return(0,Q.jsx)(M.A,{})}},Se=e=>{switch(e){case"video":return"error";case"notes":return"primary";case"cats":case"assignments":case"pastExams":return"warning";default:return"info"}},Ie=()=>{je(null),ge(null)};return X?(0,Q.jsxs)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[(0,Q.jsx)(r.A,{}),(0,Q.jsx)(l.A,{variant:"h6",sx:{ml:2},children:"Loading approved content..."})]}):(0,Q.jsxs)(s.A,{maxWidth:"lg",children:[(0,Q.jsxs)(a.A,{sx:{mb:4},children:[(0,Q.jsx)(l.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:2},children:"\ud83d\udcda Approved Content Management"}),(0,Q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"View, edit, and manage all approved educational content"})]}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"success.main",color:"white"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ce.approved}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u2705 Approved Content"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"warning.main",color:"white"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ce.premium}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\u2b50 Premium Content"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:4,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"info.main",color:"white"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",sx:{fontWeight:600,color:"white"},children:ce.total}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"white"},children:"\ud83d\udcca Total Content"})]})})})]}),se&&(0,Q.jsx)(N.A,{severity:0===re.length?"info":"error",sx:{mb:3},children:se}),(0,Q.jsx)(x.Ay,{container:!0,spacing:3,children:re.map((e,t)=>{var n,i,o,s,r;return(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{sx:{border:1,borderColor:"divider"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Q.jsx)(A.A,{sx:{bgcolor:"".concat(Se(e.type),".main"),color:"white"},children:Ce(e.type)}),(0,Q.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,Q.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:e.topicTitle||(null===(n=e.content)||void 0===n?void 0:n.title)||"".concat(e.type.toUpperCase()," Content")}),(null===(i=e.content)||void 0===i?void 0:i.isPremium)&&(0,Q.jsx)(J.A,{color:"warning",sx:{fontSize:20}})]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcda Course: ",e.courseName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcd6 Unit: ",e.unitName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc1 File: ",(null===(o=e.content)||void 0===o?void 0:o.filename)||(null===(s=e.content)||void 0===s?void 0:s.originalName)||"Unknown file"]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\ud83d\udcc5 Approved: ",new Date((null===(r=e.content)||void 0===r?void 0:r.reviewDate)||e.uploadDate).toLocaleDateString()]})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Q.jsx)(D.A,{label:e.type.toUpperCase(),color:Se(e.type),size:"small"}),(0,Q.jsx)(c.A,{onClick:t=>((e,t)=>{je(e.currentTarget),ge(t)})(t,e),size:"small",children:(0,Q.jsx)(te.A,{})})]})]})})})},"".concat(e.courseId,"_").concat(e.unitId,"_").concat(e.topicId||e.assessmentId,"_").concat(t))})}),0===re.length&&!X&&(0,Q.jsxs)(a.A,{sx:{textAlign:"center",py:8},children:[(0,Q.jsx)(l.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"\ud83d\udced No approved content found"}),(0,Q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"Content will appear here once it has been approved."}),(0,Q.jsx)(p.A,{variant:"outlined",onClick:we,sx:{mt:2},children:"Refresh"})]}),(0,Q.jsxs)(Z.A,{anchorEl:Ae,open:Boolean(Ae),onClose:Ie,children:[(0,Q.jsxs)($.A,{onClick:()=>(he({open:!0,content:ye}),void Ie()),children:[(0,Q.jsx)(O.A,{sx:{mr:1}}),"Preview"]}),(0,Q.jsxs)($.A,{onClick:()=>(e=>{var t,n;const i=(null===(t=e.content)||void 0===t?void 0:t.filePath)||(null===(n=e.content)||void 0===n?void 0:n.url);i?window.open("".concat("http://localhost:5001").concat(i),"_blank"):fe({open:!0,message:"File URL not available",severity:"error"})})(ye),children:["video"===(null===ye||void 0===ye?void 0:ye.type)&&(0,Q.jsx)(K.A,{sx:{mr:1}}),"notes"===(null===ye||void 0===ye?void 0:ye.type)&&(0,Q.jsx)(G.A,{sx:{mr:1}}),("cats"===(null===ye||void 0===ye?void 0:ye.type)||"assignments"===(null===ye||void 0===ye?void 0:ye.type)||"pastExams"===(null===ye||void 0===ye?void 0:ye.type))&&(0,Q.jsx)(M.A,{sx:{mr:1}}),"View File"]}),(0,Q.jsxs)($.A,{onClick:()=>(async e=>{try{var t,n,i,o;const s=(null===(t=e.content)||void 0===t?void 0:t.filePath)||(null===(n=e.content)||void 0===n?void 0:n.url);if(!s)throw new Error("File URL not available");const a=await U.A.get("".concat(s),{responseType:"blob"}),r=new Blob([a.data]),l=window.URL.createObjectURL(r),c=document.createElement("a");c.href=l,c.download=(null===(i=e.content)||void 0===i?void 0:i.filename)||(null===(o=e.content)||void 0===o?void 0:o.originalName)||"download",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),fe({open:!0,message:"File downloaded successfully",severity:"success"})}catch(se){console.error("Download error:",se),fe({open:!0,message:"Failed to download file",severity:"error"})}})(ye),children:[(0,Q.jsx)(Y.A,{sx:{mr:1}}),"Download"]}),(0,Q.jsx)(ee.A,{}),(0,Q.jsxs)($.A,{onClick:()=>(async e=>{try{var t;const n=!(null!==(t=e.content)&&void 0!==t&&t.isPremium);await U.A.put("/api/content-approval/premium",{courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type,isPremium:n}),le(t=>t.map(t=>t.topicId===e.topicId||t.assessmentId===e.assessmentId?(0,i.A)((0,i.A)({},t),{},{content:(0,i.A)((0,i.A)({},t.content),{},{isPremium:n})}):t)),de(e=>(0,i.A)((0,i.A)({},e),{},{premium:n?e.premium+1:e.premium-1})),fe({open:!0,message:"Content ".concat(n?"marked as premium":"removed from premium"),severity:"success"})}catch(se){console.error("Error updating premium status:",se),fe({open:!0,message:"Failed to update premium status",severity:"error"})}})(ye),children:[null!==ye&&void 0!==ye&&null!==(e=ye.content)&&void 0!==e&&e.isPremium?(0,Q.jsx)(ne.A,{sx:{mr:1}}):(0,Q.jsx)(J.A,{sx:{mr:1}}),null!==ye&&void 0!==ye&&null!==(t=ye.content)&&void 0!==t&&t.isPremium?"Remove Premium":"Mark Premium"]}),(0,Q.jsxs)($.A,{onClick:()=>(me({open:!0,content:ye}),void Ie()),children:[(0,Q.jsx)(ie.A,{sx:{mr:1}}),"Edit"]}),(0,Q.jsxs)($.A,{onClick:()=>(pe({open:!0,content:ye}),void Ie()),sx:{color:"error.main"},children:[(0,Q.jsx)(V.A,{sx:{mr:1}}),"Delete"]})]}),(0,Q.jsxs)(R.A,{open:ue.open,onClose:()=>he({open:!1,content:null}),maxWidth:"md",fullWidth:!0,children:[(0,Q.jsxs)(E.A,{children:["Content Preview: ",(null===(n=ue.content)||void 0===n?void 0:n.topicTitle)||(null===(d=ue.content)||void 0===d||null===(u=d.content)||void 0===u?void 0:u.title)]}),(0,Q.jsxs)(T.A,{children:[(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Type: ",null===(h=ue.content)||void 0===h||null===(j=h.type)||void 0===j?void 0:j.toUpperCase()]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["File: ",(null===(y=ue.content)||void 0===y||null===(g=y.content)||void 0===g?void 0:g.filename)||(null===(b=ue.content)||void 0===b||null===(f=b.content)||void 0===f?void 0:f.originalName)]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(w=ue.content)||void 0===w?void 0:w.courseName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(C=ue.content)||void 0===C?void 0:C.unitName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Status: ",null!==(S=ue.content)&&void 0!==S&&null!==(I=S.content)&&void 0!==I&&I.isPremium?"\u2b50 Premium":"\ud83c\udd93 Free"]})]}),(0,Q.jsx)(_.A,{children:(0,Q.jsx)(p.A,{onClick:()=>he({open:!1,content:null}),children:"Close"})})]}),(0,Q.jsxs)(R.A,{open:ve.open,onClose:()=>pe({open:!1,content:null}),maxWidth:"sm",fullWidth:!0,children:[(0,Q.jsxs)(E.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Q.jsx)(q.A,{color:"error"}),"Delete Approved Content"]}),(0,Q.jsxs)(T.A,{children:[(0,Q.jsx)(l.A,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to permanently delete this approved content from the database?"}),(0,Q.jsxs)(l.A,{variant:"subtitle2",color:"error",gutterBottom:!0,children:["Content: ",(null===(k=ve.content)||void 0===k?void 0:k.topicTitle)||(null===(L=ve.content)||void 0===L||null===(P=L.content)||void 0===P?void 0:P.title)]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",null===(H=ve.content)||void 0===H?void 0:H.courseName]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Unit: ",null===(z=ve.content)||void 0===z?void 0:z.unitName]}),(0,Q.jsx)(N.A,{severity:"error",sx:{mt:2},children:"\u26a0\ufe0f This action cannot be undone! The content will be permanently removed from the database."})]}),(0,Q.jsxs)(_.A,{children:[(0,Q.jsx)(p.A,{onClick:()=>pe({open:!1,content:null}),children:"Cancel"}),(0,Q.jsx)(p.A,{variant:"contained",color:"error",onClick:async()=>{try{const e=ve.content;await U.A.delete("/api/content-approval/delete",{data:{courseId:e.courseId,unitId:e.unitId,topicId:e.topicId,assessmentId:e.assessmentId,contentType:e.type}}),le(t=>t.filter(t=>t.topicId!==e.topicId&&t.assessmentId!==e.assessmentId)),de(t=>{var n;return(0,i.A)((0,i.A)({},t),{},{approved:Math.max(0,t.approved-1),premium:null!==(n=e.content)&&void 0!==n&&n.isPremium?Math.max(0,t.premium-1):t.premium,total:Math.max(0,t.total-1)})}),fe({open:!0,message:"Content deleted successfully from database",severity:"success"}),pe({open:!1,content:null})}catch(se){var e,t;console.error("Error deleting content:",se),fe({open:!0,message:"Failed to delete content: ".concat((null===(e=se.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||se.message),severity:"error"})}},startIcon:(0,Q.jsx)(V.A,{}),children:"Delete Permanently"})]})]}),(0,Q.jsx)(B.A,{open:be.open,autoHideDuration:6e3,onClose:()=>fe((0,i.A)((0,i.A)({},be),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,Q.jsx)(N.A,{onClose:()=>fe((0,i.A)((0,i.A)({},be),{},{open:!1})),severity:be.severity,sx:{width:"100%"},children:be.message})})]})};var se=n(2046),ae=n(5979),re=n(3788),le=n(6101),ce=n(6868),de=n(6986),ue=n(5546),he=n(4801),xe=n(5834);const me=e=>{var t,n;let{institution:c,onBack:d}=e;const[u,h]=(0,o.useState)(!0),[A,j]=(0,o.useState)([]),[y,g]=(0,o.useState)(!0),[b,f]=(0,o.useState)(null),[w,C]=(0,o.useState)(null),[S,I]=(0,o.useState)({});(0,o.useEffect)(()=>{if(c){h(!1);(async()=>{try{f(null),g(!0);const e=await U.A.get("/api/courses",{params:{institution:c._id}});j(e.data.courses||[])}catch(e){console.error("Error loading courses:",e),f("Failed to load courses for this institution.")}finally{g(!1)}})()}},[c]);const k=(0,o.useCallback)(async e=>{var t,n;if(!(null!==(t=S[e])&&void 0!==t&&t.data||null!==(n=S[e])&&void 0!==n&&n.loading)){I(t=>(0,i.A)((0,i.A)({},t),{},{[e]:{loading:!0,error:null,data:null}}));try{var o;const t=(null===(o=(await U.A.get("/api/courses/".concat(e))).data)||void 0===o?void 0:o.course)||{},n=(Array.isArray(t.units)?t.units:[]).reduce((e,t)=>{var n,i;const o=null!==(n=t.year)&&void 0!==n?n:"Unspecified Year",s=null!==(i=t.semester)&&void 0!==i?i:"General";return e[o]||(e[o]={}),e[o][s]||(e[o][s]=[]),e[o][s].push(t),e},{});I(o=>(0,i.A)((0,i.A)({},o),{},{[e]:{loading:!1,error:null,data:(0,i.A)((0,i.A)({},t),{},{unitsByYear:n})}}))}catch(s){console.error("Error loading course details:",s),I(t=>(0,i.A)((0,i.A)({},t),{},{[e]:{loading:!1,error:"Failed to load units for this course.",data:null}}))}}},[S]),R=(0,o.useCallback)(e=>async(t,n)=>{C(n?e:null),n&&await k(e)},[k]);return u?(0,Q.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,Q.jsx)(r.A,{})}):(0,Q.jsxs)(s.A,{maxWidth:"lg",children:[(0,Q.jsx)(a.A,{sx:{mb:4},children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",color:"primary",sx:{fontWeight:600,mb:1},children:c.name}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[null===(t=c.location)||void 0===t?void 0:t.town,", ",null===(n=c.location)||void 0===n?void 0:n.county]})]}),(0,Q.jsx)(p.A,{variant:"outlined",startIcon:(0,Q.jsx)(he.A,{}),onClick:d,children:"Back to Institutions"})]})}),(0,Q.jsx)(l.A,{variant:"h5",sx:{fontWeight:600,mb:3},children:"Institution Details - Minimal View"}),(0,Q.jsxs)(a.A,{sx:{mt:5},children:[(0,Q.jsx)(l.A,{variant:"h5",sx:{fontWeight:600,mb:2},children:"Courses Offered"}),y&&(0,Q.jsxs)(a.A,{display:"flex",alignItems:"center",gap:2,sx:{py:3},children:[(0,Q.jsx)(r.A,{size:24}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Loading courses..."})]}),!y&&b&&(0,Q.jsx)(N.A,{severity:"error",children:b}),!y&&!b&&0===A.length&&(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{py:2},children:"No courses found for this institution yet."}),!y&&!b&&A.length>0&&(0,Q.jsx)(x.Ay,{container:!0,spacing:3,sx:{mt:1},children:A.map(e=>{var t,n,i;return(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,Q.jsxs)(ce.A,{elevation:2,expanded:w===(e._id||e.code),onChange:R(e._id||e.code),children:[(0,Q.jsx)(de.A,{expandIcon:(0,Q.jsx)(xe.A,{}),children:(0,Q.jsxs)(a.A,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%"},children:[(0,Q.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:e.name}),e.code&&(0,Q.jsx)(D.A,{label:e.code,color:"primary",size:"small"})]}),e.department&&(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Department: ",e.department]}),e.duration&&(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Duration: ",e.duration.years," years \xb7 ",e.duration.semesters," semesters"]}),e.description&&(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.description.length>180?"".concat(e.description.slice(0,180),"..."):e.description})]})}),(0,Q.jsxs)(ue.A,{children:[(null===(t=S[e._id||e.code])||void 0===t?void 0:t.loading)&&(0,Q.jsxs)(a.A,{display:"flex",alignItems:"center",gap:2,sx:{py:2},children:[(0,Q.jsx)(r.A,{size:20}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Loading units..."})]}),(null===(n=S[e._id||e.code])||void 0===n?void 0:n.error)&&(0,Q.jsx)(N.A,{severity:"error",children:S[e._id||e.code].error}),(null===(i=S[e._id||e.code])||void 0===i?void 0:i.data)&&(0,Q.jsx)(a.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:Object.entries(S[e._id||e.code].data.unitsByYear).sort((e,t)=>{let[n]=e,[i]=t;const o=parseInt(n,10),s=parseInt(i,10);return Number.isNaN(o)||Number.isNaN(s)?String(n).localeCompare(String(i)):o-s}).map(e=>{let[t,n]=e;return(0,Q.jsxs)(a.A,{children:[(0,Q.jsxs)(l.A,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:["Year ",t]}),Object.entries(n).sort((e,t)=>{let[n]=e,[i]=t;const o=parseInt(n,10),s=parseInt(i,10);return Number.isNaN(o)||Number.isNaN(s)?String(n).localeCompare(String(i)):o-s}).map(e=>{let[t,n]=e;return(0,Q.jsxs)(a.A,{sx:{mb:2},children:[(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{fontWeight:600,mb:1},children:["Semester ",t]}),(0,Q.jsx)(x.Ay,{container:!0,spacing:2,children:n.map(e=>(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(m.A,{variant:"outlined",sx:{height:"100%"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"subtitle2",sx:{fontWeight:600},children:e.unitName||e.name}),e.unitCode&&(0,Q.jsxs)(l.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:1},children:["Code: ",e.unitCode]}),e.creditHours&&(0,Q.jsxs)(l.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:1},children:["Credit Hours: ",e.creditHours]}),e.description&&(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.description.length>140?"".concat(e.description.slice(0,140),"..."):e.description})]})})},e._id||e.unitCode))})]},t)})]},t)})})]})]})},e._id||e.code)})})]})]})},ve=["public_university","private_university","medical_college","polytechnic","teachers_college","technical_institute"],pe=["Nairobi","Mombasa","Kisumu","Nakuru","Eldoret","Thika","Malindi","Kitale","Garissa","Kakamega","Machakos","Meru","Nyeri","Kericho","Embu","Migori","Bungoma","Homa Bay","Vihiga","Bomet"],Ae=e=>{let{userRole:t}=e;const[n,c]=(0,o.useState)([]),[d,u]=(0,o.useState)(!0),[h,A]=(0,o.useState)(""),[y,g]=(0,o.useState)(null),[b,f]=(0,o.useState)(!1),[w,C]=(0,o.useState)(""),[S,k]=(0,o.useState)(""),[D,L]=(0,o.useState)(!1),[P,B]=(0,o.useState)(null),[F,W]=(0,o.useState)(()=>({name:"",shortName:"",type:"",location:{town:"",county:"",address:""},contact:{phone:"",email:"",website:""},description:""}));(0,o.useEffect)(()=>{M()},[]);const M=async()=>{try{u(!0);const e=await U.A.get("/api/institutions");c(e.data.institutions||[])}catch(S){console.error("Error fetching institutions:",S),k("Failed to fetch institutions. Displaying mock data."),c([{_id:"1",name:"University of Nairobi",shortName:"UoN",type:"University",location:{town:"Nairobi",county:"Nairobi"},description:"Premier university in Kenya.",established:"1970",programs:45,students:84e3},{_id:"2",name:"Kenyatta University",shortName:"KU",type:"University",location:{town:"Kahawa",county:"Kiambu"},description:"Public university known for education.",established:"1985",programs:38,students:7e4}])}finally{u(!1)}},O=()=>{f(!1),g(null),W({name:"",shortName:"",type:"",location:{town:"",county:"",address:""},contact:{phone:"",email:"",website:""},description:""}),k("")},H=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W(n?o=>(0,i.A)((0,i.A)({},o),{},{[n]:(0,i.A)((0,i.A)({},o[n]),{},{[e]:t})}):n=>(0,i.A)((0,i.A)({},n),{},{[e]:t}))},z=()=>{L(!1),B(null)},V=n.filter(e=>{var t,n,i,o;return((null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"").includes(h.toLowerCase())||((null===(n=e.type)||void 0===n?void 0:n.toLowerCase())||"").includes(h.toLowerCase())||((null===(i=e.location)||void 0===i||null===(o=i.county)||void 0===o?void 0:o.toLowerCase())||"").includes(h.toLowerCase())});return d?(0,Q.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,Q.jsx)(r.A,{})}):D&&P?(0,Q.jsx)(me,{institution:P,onBack:z}):(0,Q.jsxs)(s.A,{maxWidth:"xl",children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,Q.jsx)(l.A,{variant:"h5",fontWeight:"bold",children:"Institution Management"}),"super_admin"===t&&(0,Q.jsx)(p.A,{variant:"contained",color:"primary",onClick:()=>{g(null),W({name:"",shortName:"",type:"",location:{town:"",county:"",address:""},contact:{phone:"",email:"",website:""},description:""}),f(!0),k("")},children:"Add Institution"})]}),S&&(0,Q.jsx)(N.A,{severity:"error",sx:{mb:2},children:S}),w&&(0,Q.jsx)(N.A,{severity:"success",sx:{mb:2},children:w}),(0,Q.jsx)(j.A,{fullWidth:!0,placeholder:"Search institutions by name, type, or county...",value:h,onChange:e=>A(e.target.value),sx:{mb:3},InputProps:{startAdornment:(0,Q.jsx)(se.A,{position:"start",children:(0,Q.jsx)(I.A,{})})}}),(0,Q.jsx)(x.Ay,{container:!0,spacing:3,children:V.map(e=>{var i,o;return(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,Q.jsxs)(m.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,Q.jsxs)(v.A,{sx:{flexGrow:1},children:[(0,Q.jsx)(l.A,{variant:"h6",component:"h3",gutterBottom:!0,children:e.name}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.type}),(0,Q.jsxs)(l.A,{variant:"body2",sx:{mb:2},children:["\ud83d\udccd ",null===(i=e.location)||void 0===i?void 0:i.town,", ",null===(o=e.location)||void 0===o?void 0:o.county]})]}),(0,Q.jsxs)(a.A,{sx:{p:2,pt:0},children:[(0,Q.jsx)(p.A,{size:"small",variant:"contained",color:"primary",onClick:()=>(e=>{B(e),L(!0)})(e),sx:{mr:1},children:"View Details"}),"super_admin"===t&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(p.A,{size:"small",onClick:()=>(e=>{var t,n,i,o,s,a;g(e),W({name:e.name||"",shortName:e.shortName||"",type:e.type||"",location:{town:(null===(t=e.location)||void 0===t?void 0:t.town)||"",county:(null===(n=e.location)||void 0===n?void 0:n.county)||"",address:(null===(i=e.location)||void 0===i?void 0:i.address)||""},contact:{phone:(null===(o=e.contact)||void 0===o?void 0:o.phone)||"",email:(null===(s=e.contact)||void 0===s?void 0:s.email)||"",website:(null===(a=e.contact)||void 0===a?void 0:a.website)||""},description:e.description||""}),f(!0),k("")})(e),sx:{mr:1},children:"Edit"}),(0,Q.jsx)(p.A,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this institution?"))try{await U.A.delete("/api/institutions/".concat(e)),c(n.filter(t=>t._id!==e)),C("Institution deleted successfully"),setTimeout(()=>C(""),3e3)}catch(S){k("Failed to delete institution"),setTimeout(()=>k(""),3e3)}})(e._id),children:"Delete"})]})]})]})},e._id)})}),0===V.length&&!d&&(0,Q.jsx)(a.A,{sx:{textAlign:"center",py:4},children:(0,Q.jsx)(l.A,{variant:"h6",color:"text.secondary",children:"No institutions found matching your search criteria"})}),(0,Q.jsxs)(R.A,{open:b,onClose:O,maxWidth:"md",fullWidth:!0,children:[(0,Q.jsx)(E.A,{children:y?"Edit Institution":"Add Institution"}),(0,Q.jsx)(T.A,{dividers:!0,children:(0,Q.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mt:.5},children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Institution Name",value:F.name,onChange:e=>H("name",e.target.value),required:!0})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Short Name",value:F.shortName,onChange:e=>H("shortName",e.target.value),required:!0})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsxs)(ae.A,{fullWidth:!0,required:!0,children:[(0,Q.jsx)(re.A,{children:"Institution Type"}),(0,Q.jsx)(le.A,{value:F.type,label:"Institution Type",onChange:e=>H("type",e.target.value),children:ve.map(e=>(0,Q.jsx)($.A,{value:e,children:e.replace("_"," ").toUpperCase()},e))})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsxs)(ae.A,{fullWidth:!0,required:!0,children:[(0,Q.jsx)(re.A,{children:"County"}),(0,Q.jsx)(le.A,{value:F.location.county,label:"County",onChange:e=>H("county",e.target.value,"location"),children:pe.map(e=>(0,Q.jsx)($.A,{value:e,children:e},e))})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Town/City",value:F.location.town,onChange:e=>H("town",e.target.value,"location")})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Address",value:F.location.address,onChange:e=>H("address",e.target.value,"location")})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Phone",value:F.contact.phone,onChange:e=>H("phone",e.target.value,"contact")})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Email",type:"email",value:F.contact.email,onChange:e=>H("email",e.target.value,"contact")})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Website",value:F.contact.website,onChange:e=>H("website",e.target.value,"contact")})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(j.A,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:F.description,onChange:e=>H("description",e.target.value)})})]})}),(0,Q.jsxs)(_.A,{children:[(0,Q.jsx)(p.A,{onClick:O,children:"Cancel"}),(0,Q.jsx)(p.A,{variant:"contained",onClick:async()=>{try{const e=(0,i.A)((0,i.A)({},F),{},{location:(0,i.A)({},F.location),contact:(0,i.A)({},F.contact)});y?(await U.A.put("/api/institutions/".concat(y._id),e),C("Institution updated successfully.")):(await U.A.post("/api/institutions",e),C("Institution created successfully.")),f(!1),W({name:"",shortName:"",type:"",location:{town:"",county:"",address:""},contact:{phone:"",email:"",website:""},description:""}),g(null),k(""),await M(),setTimeout(()=>C(""),4e3)}catch(e){console.error("Error saving institution:",e),k("Failed to save institution. Please try again."),setTimeout(()=>k(""),4e3)}},children:y?"Update":"Create"})]})]})]})},je=()=>{var e,t,n,N,D,R,E,T,_,L,P,B,F,W,M,O,H,z,V,K,G,Y,J,q,Z,$,ee,te,ne,ie,se,ae,re,le,ce,de,ue,he,xe,me,ve,pe,je,ye,ge,be,fe,we,Ce;const[Se,Ie]=(0,o.useState)(null),[ke,Ue]=(0,o.useState)(!0),[Ne,De]=(0,o.useState)(0),[Re,Ee]=(0,o.useState)([]),[Te,_e]=(0,o.useState)(""),[Le,Pe]=(0,o.useState)("all"),[Be,Fe]=(0,o.useState)("all"),{user:We}=(0,k.A)();(0,o.useEffect)(()=>{Me()},[]),(0,o.useEffect)(()=>{const e=e=>{const{tabId:t}=e.detail,n={institutions:1,"content-approval":2,"user-management":3,financial:4,"system-health":5};void 0!==n[t]&&De(n[t])};return window.addEventListener("superAdminTabChange",e),()=>window.removeEventListener("superAdminTabChange",e)},[]);const Me=async()=>{try{Ue(!0);const[e,t,n,i]=await Promise.allSettled([U.A.get("/api/admin/users"),U.A.get("/api/admin/payments"),U.A.get("/api/institutions"),U.A.get("/api/content-approval/pending")]),o={connectionStatus:"online",dataSource:{users:"database",payments:"database",institutions:"database",content:"database"}};if("fulfilled"===e.status){const t=e.value.data.users||[];Ee(t),o.totalUsers=t.length,o.activeUsers=t.filter(e=>e.isActive).length,o.newUsersThisMonth=t.filter(e=>{const t=new Date(e.createdAt),n=new Date;return t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()}).length}else console.error("Failed to fetch users:",e.reason),o.dataSource.users="cache",o.totalUsers=0,o.activeUsers=0,o.newUsersThisMonth=0,Ee([]);if("fulfilled"===t.status){const e=t.value.data.payments||[],n=e.reduce((e,t)=>e+(t.amount||0),0);o.totalRevenue=n,o.totalPayments=e.length,o.revenueThisMonth=e.filter(e=>{const t=new Date(e.createdAt),n=new Date;return t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()}).reduce((e,t)=>e+(t.amount||0),0)}else console.error("Failed to fetch payments:",t.reason),o.dataSource.payments="cache",o.totalRevenue=0,o.totalPayments=0,o.revenueThisMonth=0;if("fulfilled"===n.status){const e=n.value.data.institutions||[];o.totalInstitutions=e.length}else console.error("Failed to fetch institutions:",n.reason),o.dataSource.institutions="cache",o.totalInstitutions=0;if("fulfilled"===i.status){const e=i.value.data.pendingContent||[];o.pendingContent=e.length,o.approvedContent=0,o.rejectedContent=0}else console.error("Failed to fetch content stats:",i.reason),o.dataSource.content="cache",o.pendingContent=0,o.approvedContent=0,o.rejectedContent=0;Object.values(o.dataSource).some(e=>"cache"===e)&&(o.connectionStatus="offline"),Ie(o)}catch(e){console.error("Dashboard data fetch error:",e),Ie({connectionStatus:"offline",dataSource:{users:"cache",payments:"cache",institutions:"cache",content:"cache"},totalUsers:0,activeUsers:0,newUsersThisMonth:0,totalRevenue:0,totalPayments:0,revenueThisMonth:0,totalInstitutions:0,pendingContent:0,approvedContent:0,rejectedContent:0})}finally{Ue(!1)}},Oe=async()=>{await Me(),alert("Dashboard data refreshed successfully!")},He=async()=>{try{const e=(await U.A.get("/api/admin/users")).data.users||[],t=e.filter(e=>e.isActive).length,n=e.filter(e=>"mini_admin"===e.role||"super_admin"===e.role).length;alert("Database Connection Successful!\n\nUser Statistics:\n\u2022 Total Users: ".concat(e.length,"\n\u2022 Active Users: ").concat(t,"\n\u2022 Admin Users: ").concat(n,"\n\u2022 Data Source: Live Database"))}catch(e){console.error("Database connection failed:",e),alert("Database Connection Failed!\n\nUsing Fallback Data:\n\u2022 Total Users: 847\n\u2022 Active Users: 782\n\u2022 Admin Users: 15\n\u2022 Data Source: Local Cache\n\nError: ".concat(e.message))}},ze=async()=>{try{const e=(await U.A.get("/api/admin/users")).data.users||[],t={exportDate:(new Date).toISOString(),dataSource:"Live Database",totalUsers:e.length,activeUsers:e.filter(e=>e.isActive).length,inactiveUsers:e.filter(e=>!e.isActive).length,students:e.filter(e=>"student"===e.role).length,miniAdmins:e.filter(e=>"mini_admin"===e.role).length,superAdmins:e.filter(e=>"super_admin"===e.role).length,users:e.map(e=>{var t;return{id:e._id,name:"".concat(e.firstName||""," ").concat(e.lastName||"").trim(),email:e.email,role:e.role,isActive:e.isActive,institution:"object"===typeof e.institution?(null===(t=e.institution)||void 0===t?void 0:t.name)||"Not specified":e.institution||"Not specified",createdAt:e.createdAt}})},n=JSON.stringify(t,null,2),i=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download="user-data-export-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(o),alert("Export Successful!\nExported ".concat(e.length," users from live database"))}catch(e){console.error("Database export failed:",e);const t={exportDate:(new Date).toISOString(),dataSource:"Fallback Cache",totalUsers:847,activeUsers:782,inactiveUsers:65,students:820,miniAdmins:12,superAdmins:3,error:e.message},n=JSON.stringify(t,null,2),i=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download="user-data-export-fallback-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(o),alert("Database connection failed!\nExported fallback data instead.\nError: ".concat(e.message))}},Ve=async()=>{const e=Ge().filter(e=>"super_admin"!==e.role);if(0===e.length)return void alert("No eligible users found for bulk role management.\n\nSuper admins cannot have their roles changed.");const t=prompt("Bulk Role Management\n\nFound ".concat(e.length," eligible users\n\nSelect new role for all:\n- student\n- mini_admin\n\nEnter role:"),"student");if(t&&["student","mini_admin"].includes(t)&&window.confirm('Change role to "'.concat(t,'" for ').concat(e.length," users?"))){let o=0,s=0;for(const i of e.slice(0,5))try{await U.A.put("/api/admin/users/".concat(i._id,"/role"),{role:t}),o++}catch(n){s++}Ee(Re.map(n=>e.some(e=>e._id===n._id)?(0,i.A)((0,i.A)({},n),{},{role:t}):n)),alert("\u2705 Bulk role update completed!\n\n\u2705 Success: ".concat(o," users\n\u274c Failed: ").concat(s," users\n\nRole changed to: ").concat(t.toUpperCase())),Me()}},Ke=async()=>{try{const e=(await U.A.get("/api/admin/payments")).data.payments||[],t=e.reduce((e,t)=>e+(t.amount||0),0),n=e.filter(e=>"subscription"===e.type).reduce((e,t)=>e+(t.amount||0),0),i=e.filter(e=>"job_unlock"===e.type).reduce((e,t)=>e+(t.amount||0),0),o={reportDate:(new Date).toISOString(),dataSource:"Live Database",totalRevenue:t,subscriptionRevenue:n,jobUnlockRevenue:i,totalTransactions:e.length,successfulPayments:e.filter(e=>"completed"===e.status).length,pendingPayments:e.filter(e=>"pending"===e.status).length,failedPayments:e.filter(e=>"failed"===e.status).length,mpesaTransactions:e.filter(e=>"mpesa"===e.paymentMethod).length,averageTransactionValue:t/e.length||0,payments:e.map(e=>({id:e._id,amount:e.amount,currency:e.currency,type:e.type,status:e.status,mpesaTransactionId:e.mpesaTransactionId,createdAt:e.createdAt}))},s=JSON.stringify(o,null,2),a=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download="financial-report-".concat((new Date).toISOString().split("T")[0],".json"),l.click(),URL.revokeObjectURL(r),alert("Financial Report Generated!\n\nDatabase Summary:\n\u2022 Total Revenue: KSH ".concat(t.toLocaleString(),"\n\u2022 Transactions: ").concat(e.length,"\n\u2022 Data Source: Live Database"))}catch(e){console.error("Financial database connection failed:",e);const t={reportDate:(new Date).toISOString(),dataSource:"Fallback Cache",totalRevenue:45230,subscriptionRevenue:31500,jobUnlockRevenue:13730,monthlyGrowth:"+12.5%",transactions:1247,error:e.message},n=JSON.stringify(t,null,2),i=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download="financial-report-fallback-".concat((new Date).toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(o),alert("Database Connection Failed!\n\nGenerated Fallback Report:\n\u2022 Total Revenue: KSH 45,230\n\u2022 Transactions: 1,247\n\u2022 Data Source: Local Cache\n\nError: ".concat(e.message))}},Ge=()=>0===Re.length?[]:Re.filter(e=>{var t,n,i;const o=!Te||(null===(t=e.firstName)||void 0===t?void 0:t.toLowerCase().includes(Te.toLowerCase()))||(null===(n=e.lastName)||void 0===n?void 0:n.toLowerCase().includes(Te.toLowerCase()))||(null===(i=e.email)||void 0===i?void 0:i.toLowerCase().includes(Te.toLowerCase())),s="all"===Le||e.role===Le,a="all"===Be||"active"===Be&&e.isActive||"inactive"===Be&&!e.isActive;return o&&s&&a}),Ye=e=>{switch(e){case"super_admin":return"\ud83d\udc51";case"mini_admin":return"\u26a1";default:return"\ud83d\udc64"}},Je=e=>{switch(e){case"super_admin":return"error.main";case"mini_admin":return"warning.main";default:return"primary.main"}};return ke?(0,Q.jsx)(s.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,Q.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,Q.jsx)(r.A,{})})}):(0,Q.jsx)(s.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,Q.jsxs)("div",{children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Super Admin Dashboard"}),(0,Q.jsxs)(l.A,{variant:"body1",color:"text.secondary",children:["Welcome back, ",(null===We||void 0===We?void 0:We.firstName)||"Admin","! Here's what's happening with your platform."]})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:2},children:[(0,Q.jsx)(c.A,{color:"primary",size:"large",children:(0,Q.jsx)(d.A,{badgeContent:4,color:"error",children:(0,Q.jsx)(y.A,{})})}),(0,Q.jsx)(c.A,{color:"primary",size:"large",children:(0,Q.jsx)(g.A,{})})]})]}),(0,Q.jsx)(a.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,Q.jsxs)(u.A,{value:Ne,onChange:(e,t)=>{De(t)},"aria-label":"admin dashboard tabs",children:[(0,Q.jsx)(h.A,{label:"\ud83d\udcca Overview"}),(0,Q.jsx)(h.A,{label:"\ud83c\udfeb Institutions"}),(0,Q.jsx)(h.A,{label:"\ud83d\udccb Content Approval"}),(0,Q.jsx)(h.A,{label:"\ud83d\udcda Approved Content"}),(0,Q.jsx)(h.A,{label:"\ud83d\udc65 User Management"}),(0,Q.jsx)(h.A,{label:"\ud83d\udcb0 Financial Analytics"}),(0,Q.jsx)(h.A,{label:"\ud83d\udd27 System Health"})]})}),0===Ne&&(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.light":"success.light",border:2,borderColor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.main":"success.main"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsx)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,Q.jsx)(l.A,{variant:"h5",sx:{color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.dark":"success.dark",fontWeight:"bold"},children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\ud83d\udd34 DATABASE OFFLINE":"\ud83d\udfe2 DATABASE CONNECTED"})}),(0,Q.jsx)(p.A,{variant:"contained",color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error":"success",onClick:Oe,startIcon:(0,Q.jsx)(b.A,{}),children:"Test Connection"})]}),(0,Q.jsx)(l.A,{variant:"body1",sx:{mt:1,color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.dark":"success.dark"},children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\u26a0\ufe0f Using cached data. Database connection failed. Some features may be limited.":"\u2705 Connected to live database. All features are fully operational."}),(null===Se||void 0===Se?void 0:Se.dataSource)&&(0,Q.jsxs)(a.A,{sx:{mt:2,p:2,bgcolor:"rgba(255,255,255,0.3)",borderRadius:1},children:[(0,Q.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Data Source Status:"}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:1,children:[(0,Q.jsx)(x.Ay,{item:!0,xs:6,md:3,children:(0,Q.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc65 Users: ",(0,Q.jsx)("strong",{children:"database"===Se.dataSource.users?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:6,md:3,children:(0,Q.jsxs)(l.A,{variant:"caption",children:["\ud83d\udcb0 Payments: ",(0,Q.jsx)("strong",{children:"database"===Se.dataSource.payments?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:6,md:3,children:(0,Q.jsxs)(l.A,{variant:"caption",children:["\ud83c\udfeb Institutions: ",(0,Q.jsx)("strong",{children:"database"===Se.dataSource.institutions?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:6,md:3,children:(0,Q.jsxs)(l.A,{variant:"caption",children:["\ud83d\udcda Content: ",(0,Q.jsx)("strong",{children:"database"===Se.dataSource.content?"\ud83d\udfe2 Live":"\ud83d\udd34 Cache"})]})})]})]})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{sx:{border:"database"===(null===Se||void 0===Se||null===(e=Se.dataSource)||void 0===e?void 0:e.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(t=Se.dataSource)||void 0===t?void 0:t.users)?"success.main":"grey.300"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["Total Users ","database"===(null===Se||void 0===Se||null===(n=Se.dataSource)||void 0===n?void 0:n.users)?"\ud83d\udfe2":"\ud83d\udd34"]}),(0,Q.jsx)(l.A,{variant:"h4",children:(null===Se||void 0===Se||null===(N=Se.totalUsers)||void 0===N?void 0:N.toLocaleString())||"1,247"}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(D=Se.dataSource)||void 0===D?void 0:D.users)?"Live Database":"Cached Data"})]}),(0,Q.jsx)(A.A,{sx:{bgcolor:"primary.main"},children:(0,Q.jsx)(f.A,{})})]})})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{sx:{border:"database"===(null===Se||void 0===Se||null===(R=Se.dataSource)||void 0===R?void 0:R.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(E=Se.dataSource)||void 0===E?void 0:E.users)?"success.main":"grey.300"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["Active Users ","database"===(null===Se||void 0===Se||null===(T=Se.dataSource)||void 0===T?void 0:T.users)?"\ud83d\udfe2":"\ud83d\udd34"]}),(0,Q.jsx)(l.A,{variant:"h4",children:(null===Se||void 0===Se||null===(_=Se.activeUsers)||void 0===_?void 0:_.toLocaleString())||"987"}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(L=Se.dataSource)||void 0===L?void 0:L.users)?"Live Database":"Cached Data"})]}),(0,Q.jsx)(A.A,{sx:{bgcolor:"success.main"},children:(0,Q.jsx)(w.A,{})})]})})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{sx:{border:"database"===(null===Se||void 0===Se||null===(P=Se.dataSource)||void 0===P?void 0:P.payments)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(B=Se.dataSource)||void 0===B?void 0:B.payments)?"success.main":"grey.300"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["Total Revenue ","database"===(null===Se||void 0===Se||null===(F=Se.dataSource)||void 0===F?void 0:F.payments)?"\ud83d\udfe2":"\ud83d\udd34"]}),(0,Q.jsxs)(l.A,{variant:"h4",children:["KSH ",(null===Se||void 0===Se||null===(W=Se.totalRevenue)||void 0===W?void 0:W.toLocaleString())||"45,230"]}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(M=Se.dataSource)||void 0===M?void 0:M.payments)?"Live Database":"Cached Data"})]}),(0,Q.jsx)(A.A,{sx:{bgcolor:"warning.main"},children:(0,Q.jsx)(C.A,{})})]})})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{sx:{border:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?1:2,borderColor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"grey.300":"success.main"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsxs)(l.A,{color:"textSecondary",gutterBottom:!0,children:["System Health ","offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\ud83d\udd34":"\ud83d\udfe2"]}),(0,Q.jsxs)(l.A,{variant:"h4",children:[(null===Se||void 0===Se?void 0:Se.systemHealth)||"98.5","%"]}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"Connection Issues":"All Systems OK"})]}),(0,Q.jsx)(A.A,{sx:{bgcolor:"info.main"},children:(0,Q.jsx)(S.A,{})})]})})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{sx:{bgcolor:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.light":"success.light",color:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"error.dark":"success.dark"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Q.jsx)(l.A,{variant:"h6",children:"Database Connection Status"}),(0,Q.jsx)(l.A,{variant:"h6",children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"\ud83d\udd34 OFFLINE":"\ud83d\udfe2 ONLINE"})]}),(0,Q.jsx)(l.A,{variant:"body2",sx:{mt:1},children:"offline"===(null===Se||void 0===Se?void 0:Se.connectionStatus)?"Using fallback data. Some features may be limited.":"Connected to live database. All features available."}),(null===Se||void 0===Se?void 0:Se.dataSource)&&(0,Q.jsxs)(l.A,{variant:"caption",sx:{mt:1,display:"block"},children:["Data Sources: Users (",Se.dataSource.users,"), Payments (",Se.dataSource.payments,"), Institutions (",Se.dataSource.institutions,"), Content (",Se.dataSource.content,")"]})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[(0,Q.jsx)(p.A,{variant:"contained",color:"primary",onClick:Oe,startIcon:(0,Q.jsx)(b.A,{}),children:"Refresh Data"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>{const e={generatedAt:(new Date).toISOString(),totalUsers:(null===Se||void 0===Se?void 0:Se.totalUsers)||0,activeUsers:(null===Se||void 0===Se?void 0:Se.activeUsers)||0,totalRevenue:(null===Se||void 0===Se?void 0:Se.totalRevenue)||0,systemHealth:(null===Se||void 0===Se?void 0:Se.systemHealth)||0},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download="eduvault-report-".concat((new Date).toISOString().split("T")[0],".json"),o.click(),URL.revokeObjectURL(i)},children:"Export Report"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:()=>{De(5)},children:"View Analytics"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"error",onClick:()=>{De(6)},children:"System Health"})]})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Recent Activity"}),(0,Q.jsx)(a.A,{sx:{maxHeight:300,overflowY:"auto"},children:null===Se||void 0===Se||null===(O=Se.recentActivity)||void 0===O?void 0:O.map(e=>{var t;return(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,borderBottom:"1px solid #eee"},children:[(0,Q.jsx)(a.A,{children:(0,Q.jsxs)(l.A,{variant:"body2",children:[e.action,e.user&&" - ".concat(e.user),e.amount&&" - ".concat(e.amount),e.content&&" - ".concat(e.content),e.institution&&" - ".concat("object"===typeof e.institution&&(null===(t=e.institution)||void 0===t?void 0:t.name)||e.institution),e.status&&" - ".concat(e.status),e.result&&" - ".concat(e.result),e.source&&" - ".concat(e.source),e.error&&" - ".concat(e.error)]})}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.time})]},e.id)})})]})})})]}),1===Ne&&(0,Q.jsx)(Ae,{userRole:null===We||void 0===We?void 0:We.role}),2===Ne&&(0,Q.jsx)(X,{}),3===Ne&&(0,Q.jsx)(oe,{}),4===Ne&&(0,Q.jsxs)("div",{children:[(0,Q.jsx)(m.A,{sx:{mb:3,bgcolor:"database"===(null===Se||void 0===Se||null===(H=Se.dataSource)||void 0===H?void 0:H.users)?"success.light":"warning.light",border:2,borderColor:"database"===(null===Se||void 0===Se||null===(z=Se.dataSource)||void 0===z?void 0:z.users)?"success.main":"warning.main"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",sx:{color:"database"===(null===Se||void 0===Se||null===(V=Se.dataSource)||void 0===V?void 0:V.users)?"success.dark":"warning.dark",fontWeight:"bold"},children:"database"===(null===Se||void 0===Se||null===(K=Se.dataSource)||void 0===K?void 0:K.users)?"\ud83d\udfe2 USER DATABASE CONNECTED":"\ud83d\udfe1 USING CACHED USER DATA"}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"database"===(null===Se||void 0===Se||null===(G=Se.dataSource)||void 0===G?void 0:G.users)?"success.dark":"warning.dark"},children:"database"===(null===Se||void 0===Se||null===(Y=Se.dataSource)||void 0===Y?void 0:Y.users)?"All user operations will use live database data":"User operations will use cached data until database connection is restored"})]}),(0,Q.jsx)(p.A,{variant:"contained",color:"database"===(null===Se||void 0===Se||null===(J=Se.dataSource)||void 0===J?void 0:J.users)?"success":"warning",onClick:He,children:"Test User Database"})]})})}),(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"User Management"}),(0,Q.jsx)(l.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Comprehensive user administration interface with advanced filtering, role management, and subscription tracking."}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(q=Se.dataSource)||void 0===q?void 0:q.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(Z=Se.dataSource)||void 0===Z?void 0:Z.users)?"success.main":"warning.main"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",color:"primary",children:(null===Se||void 0===Se?void 0:Se.totalUsers)||"---"}),(0,Q.jsx)(l.A,{variant:"body2",children:"Total Users"}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===($=Se.dataSource)||void 0===$?void 0:$.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(ee=Se.dataSource)||void 0===ee?void 0:ee.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(te=Se.dataSource)||void 0===te?void 0:te.users)?"success.main":"warning.main"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",color:"success.main",children:(null===Se||void 0===Se?void 0:Se.activeUsers)||"---"}),(0,Q.jsx)(l.A,{variant:"body2",children:"Active Users"}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(ne=Se.dataSource)||void 0===ne?void 0:ne.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(ie=Se.dataSource)||void 0===ie?void 0:ie.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(se=Se.dataSource)||void 0===se?void 0:se.users)?"success.main":"warning.main"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",color:"warning.main",children:(null===Se||void 0===Se?void 0:Se.miniAdmins)||"---"}),(0,Q.jsx)(l.A,{variant:"body2",children:"Mini Admins"}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(ae=Se.dataSource)||void 0===ae?void 0:ae.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,Q.jsx)(m.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(re=Se.dataSource)||void 0===re?void 0:re.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(le=Se.dataSource)||void 0===le?void 0:le.users)?"success.main":"warning.main"},children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h4",color:"error.main",children:(null===Se||void 0===Se?void 0:Se.superAdmins)||"---"}),(0,Q.jsx)(l.A,{variant:"body2",children:"Super Admins"}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(ce=Se.dataSource)||void 0===ce?void 0:ce.users)?"\ud83d\udfe2 Live Data":"\ud83d\udfe1 Cached"})]})})})]}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:2,sx:{mb:4},children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"\ud83d\udee0\ufe0f Quick Actions"})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,Q.jsxs)(m.A,{variant:"outlined",sx:{p:2,height:"100%"},children:[(0,Q.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"\ud83d\udcca Data Management"}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[(0,Q.jsx)(p.A,{variant:"contained",color:"primary",onClick:He,startIcon:(0,Q.jsx)(f.A,{}),fullWidth:!0,size:"large",children:"View All Users Database"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:ze,startIcon:(0,Q.jsx)("span",{children:"\ud83d\udce5"}),fullWidth:!0,children:"Export User Data (JSON)"})]})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,Q.jsxs)(m.A,{variant:"outlined",sx:{p:2,height:"100%"},children:[(0,Q.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"warning.main",fontWeight:"bold",children:"\u26a1 Bulk Operations"}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[(0,Q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:Ve,startIcon:(0,Q.jsx)("span",{children:"\ud83d\udc65"}),fullWidth:!0,children:"Bulk Role Management"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"success",onClick:async()=>{const e=Ge().filter(e=>"super_admin"!==e.role);if(0===e.length)return void alert("No eligible users found for premium access.\n\nSuper admins already have all access.");const t=["Computer Science","Biology","Mathematics","Physics","Chemistry"],n=prompt("Bulk Premium Access Grant\n\nFound ".concat(e.length," eligible users\n\nSelect course:\n- ").concat(t.join("\n- "),"\n\nEnter course name:"),"Computer Science");if(n&&t.includes(n)&&window.confirm('Grant premium access to "'.concat(n,'" for ').concat(e.length," users?\n\nCost: KSH ").concat(70*e.length," total"))){let t=0,s=0;for(const i of e.slice(0,3))try{await U.A.post("/api/admin/grant-premium",{userId:i._id,courseId:n.toLowerCase().replace(" ","_"),courseName:n}),t++}catch(o){s++}Ee(Re.map(t=>e.some(e=>e._id===t._id)?(0,i.A)((0,i.A)({},t),{},{premiumSubscriptions:(t.premiumSubscriptions||0)+1}):t)),alert("\u2705 Bulk premium access granted!\n\n\u2705 Success: ".concat(t," users\n\u274c Failed: ").concat(s," users\n\nCourse: ").concat(n,"\nTotal Cost: KSH ").concat(70*t))}},startIcon:(0,Q.jsx)("span",{children:"\ud83d\udc8e"}),fullWidth:!0,children:"Bulk Premium Access"})]})]})})]}),(0,Q.jsxs)(m.A,{variant:"outlined",sx:{p:3,mb:4},children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"\ud83d\udd0d Search & Filter Users"}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsx)(j.A,{fullWidth:!0,placeholder:"Search users by name or email...",value:Te,onChange:e=>_e(e.target.value),variant:"outlined",InputProps:{startAdornment:(0,Q.jsx)(I.A,{sx:{mr:1,color:"text.secondary"}})},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"primary.main"}}}})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Filter by Role",value:Le,onChange:e=>Pe(e.target.value),SelectProps:{native:!0},variant:"outlined",children:[(0,Q.jsxs)("option",{value:"all",children:["\ud83c\udfaf All Roles (",(null===Se||void 0===Se?void 0:Se.totalUsers)||0,")"]}),(0,Q.jsxs)("option",{value:"student",children:["\ud83d\udc64 Students (",(null===Se||void 0===Se?void 0:Se.students)||0,")"]}),(0,Q.jsxs)("option",{value:"mini_admin",children:["\u26a1 Mini Admins (",(null===Se||void 0===Se?void 0:Se.miniAdmins)||0,")"]}),(0,Q.jsxs)("option",{value:"super_admin",children:["\ud83d\udc51 Super Admins (",(null===Se||void 0===Se?void 0:Se.superAdmins)||0,")"]})]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Filter by Status",value:Be,onChange:e=>Fe(e.target.value),SelectProps:{native:!0},variant:"outlined",children:[(0,Q.jsxs)("option",{value:"all",children:["\ud83d\udcca All Status (",(null===Se||void 0===Se?void 0:Se.totalUsers)||0,")"]}),(0,Q.jsxs)("option",{value:"active",children:["\u2705 Active Users (",(null===Se||void 0===Se?void 0:Se.activeUsers)||0,")"]}),(0,Q.jsxs)("option",{value:"inactive",children:["\u274c Inactive Users (",((null===Se||void 0===Se?void 0:Se.totalUsers)||0)-((null===Se||void 0===Se?void 0:Se.activeUsers)||0),")"]}),(0,Q.jsx)("option",{value:"premium",children:"\ud83d\udc8e Premium Users"})]})})]}),(0,Q.jsx)(a.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(0,Q.jsx)("strong",{children:"Filter Results:"})," Showing ",Ge().length," of ",(null===Se||void 0===Se?void 0:Se.totalUsers)||0," users",Te&&' \u2022 Search: "'.concat(Te,'"'),"all"!==Le&&" \u2022 Role: ".concat(Le.replace("_"," ").toUpperCase()),"all"!==Be&&" \u2022 Status: ".concat(Be.toUpperCase())]})})]}),(0,Q.jsxs)(a.A,{sx:{mb:4},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,Q.jsxs)(l.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:["\ud83d\udc65 ",Re.length>0?"Users (".concat(Ge().length," of ").concat(Re.length,")"):"Recent Users"]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>_e(""),disabled:!Te,children:"Clear Search"}),(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>{Pe("all"),Fe("all"),_e("")},children:"Reset Filters"})]})]}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,children:[Ge().slice(0,6).map(e=>{var t,n,o,s,r,c;return(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,Q.jsx)(m.A,{variant:"outlined",sx:{border:"database"===(null===Se||void 0===Se||null===(t=Se.dataSource)||void 0===t?void 0:t.users)?2:1,borderColor:"database"===(null===Se||void 0===Se||null===(n=Se.dataSource)||void 0===n?void 0:n.users)?"success.main":"warning.main",height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease","&:hover":{boxShadow:4,transform:"translateY(-2px)"}},children:(0,Q.jsxs)(v.A,{sx:{flexGrow:1},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,Q.jsxs)(A.A,{sx:{bgcolor:Je(e.role),mr:2,width:50,height:50,fontSize:"1.2rem",fontWeight:"bold"},children:[null===(o=e.firstName)||void 0===o?void 0:o.charAt(0),null===(s=e.lastName)||void 0===s?void 0:s.charAt(0)]}),(0,Q.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,Q.jsxs)(l.A,{variant:"h6",sx:{fontWeight:"bold"},children:[e.firstName," ",e.lastName]}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.email})]}),(0,Q.jsxs)(a.A,{sx:{textAlign:"center"},children:[(0,Q.jsx)(l.A,{variant:"h4",children:Ye(e.role)}),(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.role.replace("_"," ").toUpperCase()})]})]}),(0,Q.jsxs)(a.A,{sx:{mb:3},children:[(0,Q.jsxs)(x.Ay,{container:!0,spacing:2,children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:[(0,Q.jsx)("strong",{children:"\ud83c\udfeb Institution:"})," ","object"===typeof e.institution?(null===(r=e.institution)||void 0===r?void 0:r.name)||"Not specified":e.institution||"Not specified"]})}),(0,Q.jsx)(x.Ay,{item:!0,xs:6,children:(0,Q.jsx)(a.A,{sx:{p:1.5,borderRadius:1,bgcolor:e.isActive?"success.light":"error.light",textAlign:"center"},children:(0,Q.jsx)(l.A,{variant:"caption",sx:{color:e.isActive?"success.dark":"error.dark",fontWeight:"bold"},children:e.isActive?"\u2705 ACTIVE":"\u274c INACTIVE"})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:6,children:(0,Q.jsx)(a.A,{sx:{p:1.5,borderRadius:1,bgcolor:"super_admin"===e.role?"info.light":e.premiumSubscriptions>0?"warning.light":"grey.200",textAlign:"center"},children:(0,Q.jsx)(l.A,{variant:"caption",sx:{color:"super_admin"===e.role?"info.dark":e.premiumSubscriptions>0?"warning.dark":"text.secondary",fontWeight:"bold"},children:"super_admin"===e.role?"\ud83d\udc8e ALL ACCESS":e.premiumSubscriptions>0?"\ud83d\udc8e ".concat(e.premiumSubscriptions," PREMIUM"):"\ud83d\udd13 BASIC"})})})]}),(0,Q.jsx)(a.A,{sx:{mt:2,p:1,bgcolor:"grey.50",borderRadius:1,textAlign:"center"},children:(0,Q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"database"===(null===Se||void 0===Se||null===(c=Se.dataSource)||void 0===c?void 0:c.users)?"\ud83d\udfe2 Live Database Data":"\ud83d\udfe1 Sample Data"})})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,Q.jsx)(p.A,{size:"small",variant:"contained",color:"primary",onClick:()=>(e=>{var t;const n="\n\ud83d\udc64 USER PROFILE\n\n\ud83d\udccb Personal Information:\n\u2022 Name: ".concat(e.firstName," ").concat(e.lastName,"\n\u2022 Email: ").concat(e.email,"\n\u2022 Role: ").concat(e.role.replace("_"," ").toUpperCase(),"\n\u2022 Status: ").concat(e.isActive?"ACTIVE":"INACTIVE","\n\n\ud83c\udfeb Institution:\n\u2022 ").concat("object"===typeof e.institution?(null===(t=e.institution)||void 0===t?void 0:t.name)||"Not specified":e.institution||"Not specified","\n\n\ud83d\udc8e Premium Status:\n\u2022 Subscriptions: ").concat(e.premiumSubscriptions||0," active\n\u2022 Access Level: ").concat("super_admin"===e.role?"ALL ACCESS":e.premiumSubscriptions>0?"PREMIUM":"BASIC","\n\n\ud83d\udcc5 Account Details:\n\u2022 Created: ").concat(e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown","\n\u2022 User ID: ").concat(e._id,"\n\n\ud83d\udd27 Available Actions:\n\u2022 Edit profile information\n\u2022 Change user role\n\u2022 Toggle account status\n\u2022 Grant premium access\n\u2022 View subscription history\n    ");alert(n)})(e),startIcon:(0,Q.jsx)("span",{children:"\ud83d\udc64"}),fullWidth:!0,children:"View Profile"}),(0,Q.jsx)(p.A,{size:"small",variant:"outlined",color:"secondary",onClick:()=>(async e=>{try{const t=prompt("Edit First Name for ".concat(e.firstName," ").concat(e.lastName,":"),e.firstName),n=prompt("Edit Last Name for ".concat(e.firstName," ").concat(e.lastName,":"),e.lastName),o=prompt("Edit Email for ".concat(e.firstName," ").concat(e.lastName,":"),e.email);t&&n&&o&&(await U.A.put("/api/admin/users/".concat(e._id),{firstName:t,lastName:n,email:o}),Ee(Re.map(s=>s._id===e._id?(0,i.A)((0,i.A)({},s),{},{firstName:t,lastName:n,email:o}):s)),alert("\u2705 User updated successfully!\n\nName: ".concat(t," ").concat(n,"\nEmail: ").concat(o)),Me())}catch(t){console.error("Error updating user:",t),alert("\u274c Failed to update user: ".concat(t.message,"\n\nThis would update the user in the database when connected."))}})(e),startIcon:(0,Q.jsx)("span",{children:"\u270f\ufe0f"}),fullWidth:!0,children:"Edit"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,Q.jsx)(p.A,{size:"small",variant:"outlined",color:"super_admin"===e.role?"error":"warning",disabled:"super_admin"===e.role,onClick:()=>(async e=>{const t=e.role,n={student:"Student",mini_admin:"Mini Admin",super_admin:"Super Admin"},o=prompt("Change role for ".concat(e.firstName," ").concat(e.lastName,":\n\nCurrent Role: ").concat(n[t],"\n\nEnter new role:\n- student\n- mini_admin\n- super_admin"),t);if(o&&["student","mini_admin","super_admin"].includes(o)&&o!==t)try{await U.A.put("/api/admin/users/".concat(e._id,"/role"),{role:o}),Ee(Re.map(t=>t._id===e._id?(0,i.A)((0,i.A)({},t),{},{role:o}):t)),alert("\u2705 Role updated successfully!\n\n".concat(e.firstName," ").concat(e.lastName,"\n").concat(n[t]," \u2192 ").concat(n[o])),Me()}catch(s){console.error("Error updating user role:",s),alert("\u274c Failed to update role: ".concat(s.message,"\n\nThis would change the user role in the database when connected."))}else o===t&&alert("No change made - user already has this role.")})(e),startIcon:(0,Q.jsx)("span",{children:"super_admin"===e.role?"\ud83d\udd12":"\u26a1"}),fullWidth:!0,children:"super_admin"===e.role?"Protected":"Change Role"}),(0,Q.jsx)(p.A,{size:"small",variant:"outlined",color:e.isActive?"error":"success",onClick:()=>(async e=>{const t=!e.isActive,n=t?"activate":"deactivate";if(window.confirm("Are you sure you want to ".concat(n," ").concat(e.firstName," ").concat(e.lastName,"?")))try{await U.A.put("/api/admin/users/".concat(e._id,"/status"),{isActive:t}),Ee(Re.map(n=>n._id===e._id?(0,i.A)((0,i.A)({},n),{},{isActive:t}):n)),alert("\u2705 User ".concat(n,"d successfully!\n\n").concat(e.firstName," ").concat(e.lastName," is now ").concat(t?"ACTIVE":"INACTIVE")),Me()}catch(o){console.error("Error ".concat(n,"ing user:"),o),alert("\u274c Failed to ".concat(n," user: ").concat(o.message,"\n\nThis would ").concat(n," the user in the database when connected."))}})(e),startIcon:(0,Q.jsx)("span",{children:e.isActive?"\u274c":"\u2705"}),fullWidth:!0,children:e.isActive?"Deactivate":"Activate"})]}),"super_admin"!==e.role&&(0,Q.jsx)(p.A,{size:"small",variant:"outlined",color:"success",onClick:()=>(async e=>{const t=["Computer Science","Biology","Mathematics","Physics","Chemistry"],n=prompt("Grant Premium Access to ".concat(e.firstName," ").concat(e.lastName,"\n\nSelect course:\n- ").concat(t.join("\n- "),"\n\nEnter course name:"),"Computer Science");if(n&&t.includes(n))try{await U.A.post("/api/admin/grant-premium",{userId:e._id,courseId:n.toLowerCase().replace(" ","_"),courseName:n}),Ee(Re.map(t=>t._id===e._id?(0,i.A)((0,i.A)({},t),{},{premiumSubscriptions:(t.premiumSubscriptions||0)+1}):t)),alert("\u2705 Premium access granted!\n\n".concat(e.firstName," ").concat(e.lastName,"\nCourse: ").concat(n,"\nDuration: 3 months\nAmount: KSH 70"))}catch(o){console.error("Error granting premium access:",o),alert("\u274c Failed to grant premium access: ".concat(o.message,"\n\nThis would grant premium access via M-Pesa integration when connected."))}})(e),startIcon:(0,Q.jsx)("span",{children:"\ud83d\udc8e"}),fullWidth:!0,children:"Grant Premium Access"})]})]})})},e._id)}),0===Ge().length&&(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsxs)(m.A,{variant:"outlined",sx:{p:4,textAlign:"center"},children:[(0,Q.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"\ud83d\udd0d No Users Found"}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No users match your current search and filter criteria."}),(0,Q.jsx)(p.A,{variant:"outlined",onClick:()=>{Pe("all"),Fe("all"),_e("")},children:"Clear All Filters"})]})})]}),Ge().length>0&&(0,Q.jsxs)(m.A,{variant:"outlined",sx:{mt:4,p:3,textAlign:"center"},children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udcca User Management Summary"}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["Showing ",Math.min(6,Ge().length)," of ",Ge().length," filtered users",Ge().length!==((null===Se||void 0===Se?void 0:Se.totalUsers)||0)&&" (".concat((null===Se||void 0===Se?void 0:Se.totalUsers)||0," total in database)")]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[Ge().length>6&&(0,Q.jsxs)(p.A,{variant:"contained",color:"primary",onClick:He,startIcon:(0,Q.jsx)("span",{children:"\ud83d\udc65"}),children:["View All ",Ge().length," Users"]}),(0,Q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:ze,startIcon:(0,Q.jsx)("span",{children:"\ud83d\udce5"}),children:"Export Filtered Data"}),Ge().length>1&&(0,Q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:Ve,startIcon:(0,Q.jsx)("span",{children:"\u26a1"}),children:"Bulk Actions"})]}),"database"!==(null===Se||void 0===Se||null===(de=Se.dataSource)||void 0===de?void 0:de.users)&&(0,Q.jsx)(a.A,{sx:{mt:2,p:2,bgcolor:"warning.light",borderRadius:1},children:(0,Q.jsx)(l.A,{variant:"caption",color:"warning.dark",children:"\u26a0\ufe0f Showing sample data. Connect to database to see all users and perform real operations."})})]})]})]})})]}),5===Ne&&(0,Q.jsxs)("div",{children:[(0,Q.jsx)(m.A,{sx:{mb:3,bgcolor:"database"===(null===Se||void 0===Se||null===(ue=Se.dataSource)||void 0===ue?void 0:ue.payments)?"success.light":"warning.light",border:2,borderColor:"database"===(null===Se||void 0===Se||null===(he=Se.dataSource)||void 0===he?void 0:he.payments)?"success.main":"warning.main"},children:(0,Q.jsx)(v.A,{children:(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Q.jsxs)(a.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",sx:{color:"database"===(null===Se||void 0===Se||null===(xe=Se.dataSource)||void 0===xe?void 0:xe.payments)?"success.dark":"warning.dark",fontWeight:"bold"},children:"database"===(null===Se||void 0===Se||null===(me=Se.dataSource)||void 0===me?void 0:me.payments)?"\ud83d\udfe2 PAYMENT DATABASE CONNECTED":"\ud83d\udfe1 USING CACHED PAYMENT DATA"}),(0,Q.jsx)(l.A,{variant:"body2",sx:{color:"database"===(null===Se||void 0===Se||null===(ve=Se.dataSource)||void 0===ve?void 0:ve.payments)?"success.dark":"warning.dark"},children:"database"===(null===Se||void 0===Se||null===(pe=Se.dataSource)||void 0===pe?void 0:pe.payments)?"All financial data is live from M-Pesa and payment systems":"Financial reports will use cached data until database connection is restored"})]}),(0,Q.jsx)(p.A,{variant:"contained",color:"database"===(null===Se||void 0===Se||null===(je=Se.dataSource)||void 0===je?void 0:je.payments)?"success":"warning",onClick:Ke,children:"Test Payment Database"})]})})}),(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Revenue This Month"}),(0,Q.jsxs)(l.A,{variant:"h4",color:"success.main",children:["KSH ",(null===Se||void 0===Se||null===(ye=Se.totalRevenue)||void 0===ye?void 0:ye.toLocaleString())||"45,230"]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(null===Se||void 0===Se?void 0:Se.totalTransactions)||"518"," transactions"]}),(0,Q.jsx)(a.A,{sx:{mt:2},children:(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Detailed revenue report will be generated"),children:"View Details"})})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Subscription Revenue"}),(0,Q.jsxs)(l.A,{variant:"h4",color:"primary.main",children:["KSH ",(null===Se||void 0===Se||null===(ge=Se.subscriptionRevenue)||void 0===ge?void 0:ge.toLocaleString())||"31,500"]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(null===Se||void 0===Se?void 0:Se.activeSubscriptions)||"450"," active subscriptions"]}),(0,Q.jsx)(a.A,{sx:{mt:2},children:(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Subscription analytics will be displayed"),children:"Analyze"})})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Job Unlock Revenue"}),(0,Q.jsxs)(l.A,{variant:"h4",color:"warning.main",children:["KSH ",(null===Se||void 0===Se||null===(be=Se.jobUnlockRevenue)||void 0===be?void 0:be.toLocaleString())||"13,730"]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(null===Se||void 0===Se?void 0:Se.jobUnlocks)||"68"," job unlocks"]}),(0,Q.jsx)(a.A,{sx:{mt:2},children:(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Job unlock statistics will be shown"),children:"View Stats"})})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,Q.jsx)(l.A,{variant:"h6",children:"Financial Controls"}),(0,Q.jsxs)(a.A,{display:"flex",gap:2,children:[(0,Q.jsx)(p.A,{variant:"contained",color:"primary",onClick:Ke,children:"Generate Report"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>{alert("Exporting financial data to CSV format...")},children:"Export Data"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:()=>{alert("Refund management panel: Process refunds and handle payment disputes")},children:"Manage Refunds"})]})]}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Use these controls to manage financial operations and generate reports."})]})})})]})]}),6===Ne&&(0,Q.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"System Status"}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"Database"}),(0,Q.jsx)(l.A,{color:"success.main",children:"Healthy"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"API Server"}),(0,Q.jsx)(l.A,{color:"success.main",children:"Running"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"File Storage"}),(0,Q.jsx)(l.A,{color:"warning.main",children:"85% Used"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"M-Pesa Integration"}),(0,Q.jsx)(l.A,{color:"success.main",children:"Connected"})]})]}),(0,Q.jsx)(a.A,{sx:{mt:2},children:(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("System health check initiated..."),children:"Health Check"})})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Performance Metrics"}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"Average Response Time"}),(0,Q.jsx)(l.A,{color:"success.main",children:(null===Se||void 0===Se||null===(fe=Se.performance)||void 0===fe?void 0:fe.avgResponseTime)||"245ms"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"Uptime"}),(0,Q.jsx)(l.A,{color:"success.main",children:(null===Se||void 0===Se||null===(we=Se.performance)||void 0===we?void 0:we.uptime)||"99.8%"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"Daily Active Users"}),(0,Q.jsx)(l.A,{color:"primary.main",children:(null===Se||void 0===Se?void 0:Se.activeUsers)||"127"})]}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Q.jsx)(l.A,{children:"Error Rate"}),(0,Q.jsx)(l.A,{color:"success.main",children:(null===Se||void 0===Se||null===(Ce=Se.performance)||void 0===Ce?void 0:Ce.errorRate)||"0.2%"})]})]}),(0,Q.jsx)(a.A,{sx:{mt:2},children:(0,Q.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>alert("Detailed performance metrics will be displayed"),children:"View Details"})})]})})}),(0,Q.jsx)(x.Ay,{item:!0,xs:12,children:(0,Q.jsx)(m.A,{children:(0,Q.jsxs)(v.A,{children:[(0,Q.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,Q.jsx)(l.A,{variant:"h6",children:"System Controls"}),(0,Q.jsxs)(a.A,{display:"flex",gap:2,children:[(0,Q.jsx)(p.A,{variant:"contained",color:"primary",onClick:async()=>{alert("Running comprehensive system diagnostics...");try{const e=await Promise.allSettled([U.A.get("/api/admin/users").then(()=>({component:"User Database",status:"healthy",responseTime:"45ms"})),U.A.get("/api/admin/payments").then(()=>({component:"Payment System",status:"healthy",responseTime:"67ms"})),U.A.get("/api/institutions").then(()=>({component:"Institution Database",status:"healthy",responseTime:"32ms"})),U.A.get("/api/content-approval/stats").then(()=>({component:"Content Management",status:"healthy",responseTime:"28ms"}))]);setTimeout(()=>{let t="System Diagnostics Complete!\n\n",n=0,i=e.length;e.forEach((e,i)=>{if("fulfilled"===e.status){const i=e.value;t+="\u2705 ".concat(i.component,": ").concat(i.status," (").concat(i.responseTime,")\n"),n++}else{t+="\u274c ".concat(["User Database","Payment System","Institution Database","Content Management"][i],": timeout/error\n")}});const o=(n/i*100).toFixed(1);t+="\nOverall System Health: ".concat(o,"%"),t+=n===i?"\n\n\ud83c\udf89 All systems operational!":"\n\n\u26a0\ufe0f Some systems need attention",alert(t)},2e3)}catch(e){setTimeout(()=>{alert("System Diagnostics Failed!\n\n\u274c Unable to connect to backend services\n\u274c Database connections timeout\n\u274c API endpoints unreachable\n\nOverall System Health: 0%\n\n\ud83d\udea8 Critical: All systems offline\n\nError: ".concat(e.message))},2e3)}},children:"Run Diagnostics"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>{alert("System cache cleared successfully")},children:"Clear Cache"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"warning",onClick:()=>{window.confirm("Are you sure you want to restart system services? This may cause temporary downtime.")&&alert("System services restarted successfully")},children:"Restart Services"}),(0,Q.jsx)(p.A,{variant:"outlined",color:"error",onClick:()=>{window.confirm("Enable maintenance mode? This will make the platform unavailable to users.")&&alert("Maintenance mode activated. Platform is now in maintenance mode.")},children:"Maintenance Mode"})]})]}),(0,Q.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Use these controls to manage system operations and perform maintenance tasks."})]})})})]})]})})}}}]);