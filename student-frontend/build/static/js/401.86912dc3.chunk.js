"use strict";(self.webpackChunkeduvault_student_frontend=self.webpackChunkeduvault_student_frontend||[]).push([[401],{1401:(e,t,n)=>{n.r(t),n.d(t,{default:()=>xe});var s=n(8),r=n(9950),i=n(4857),o=n(470),a=n(704),l=n(6491),c=n(1413),d=n(7497),u=n(2053),x=n(5277),h=n(2235),p=n(226),m=n(5333),y=n(6639),g=n(6157),b=n(899),v=n(4745),A=n(6699),j=n(8039),f=n(3738),w=n(4616),S=n(6986),k=n(5546),I=n(3464),C=n(8170),P=n(3505),E=n(8629),R=n(8602),D=n(7898),W=n(6163),z=n(6370),L=n(2092),U=n(6191),T=n(4924),N=n(3553),M=n(1227),K=n(3297),B=n(2974),F=n(7920),_=n(3779),V=n(6904),Y=n(5834),q=n(8429),H=n(9723),O=n(5926),G=n(4414);const J=function(e){let{filename:t,backendUrl:n,isPremium:s=!1,hasSubscription:i=!1}=e;console.log("\ud83c\udfa5 Student AuthenticatedVideo component rendered with:",{filename:t,backendUrl:n,isPremium:s,hasSubscription:i});const[o,a]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(s&&!i)return h("Premium subscription required to access this content"),void d(!1);return(async()=>{try{d(!0);const e=localStorage.getItem("token");if(!e)throw new Error("Please log in to access this content");console.log("\ud83c\udfa5 Fetching video blob for student:",t);const s=await fetch("".concat(n,"/api/upload/file/").concat(t),{headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!s.ok){if(401===s.status)throw new Error("Please log in to access this content");if(403===s.status)throw new Error("You do not have permission to access this content");throw new Error("Error loading video: ".concat(s.status))}const r=await s.blob(),i=URL.createObjectURL(r);console.log("\ud83c\udfa5 Created student blob URL:",i),a(i)}catch(e){console.error("Error fetching video:",e),h(e.message)}finally{d(!1)}})(),()=>{o&&URL.revokeObjectURL(o)}},[t,n,s,i]),c?(0,G.jsx)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:300,bgcolor:"grey.900",color:"white",borderRadius:2},children:(0,G.jsxs)(l.A,{sx:{textAlign:"center"},children:[(0,G.jsx)(y.A,{color:"primary",sx:{mb:2}}),(0,G.jsx)(u.A,{variant:"body2",children:"Loading video..."})]})}):x?(0,G.jsx)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:300,bgcolor:"grey.900",color:"white",borderRadius:2,border:s?"2px solid #ffa726":"1px solid #666"},children:(0,G.jsxs)(l.A,{sx:{textAlign:"center",p:3},children:[(0,G.jsx)(P.A,{sx:{fontSize:64,mb:2,color:"grey.500"}}),(0,G.jsx)(u.A,{variant:"body2",color:"error",gutterBottom:!0,children:x}),s&&!i&&(0,G.jsx)(u.A,{variant:"caption",color:"warning.main",children:"\ud83d\udd12 Premium Content - Subscription Required"})]})}):(0,G.jsxs)(l.A,{sx:{position:"relative",borderRadius:2,overflow:"hidden",border:s?"2px solid #ffa726":"1px solid #ddd"},children:[s&&(0,G.jsx)(l.A,{sx:{position:"absolute",top:8,right:8,zIndex:10,bgcolor:"rgba(255, 167, 38, 0.9)",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold"},children:"\u2b50 PREMIUM"}),(0,G.jsx)("video",{controls:!0,width:"100%",height:"300",style:{display:"block"},preload:"metadata",controlsList:"nodownload noremoteplayback",disablePictureInPicture:!0,disableRemotePlayback:!0,onContextMenu:e=>e.preventDefault(),onLoadStart:()=>console.log("\ud83c\udfa5 Student video loading started"),onCanPlay:()=>console.log("\ud83c\udfa5 Student video ready to play"),onError:e=>console.error("\ud83c\udfa5 Student video error:",e),src:o,children:"Your browser does not support the video tag."})]})};var X=n(33),Q=n(3174),Z=n(249),$=n(4446),ee=n(4195),te=n(3563),ne=n(9925),se=n(9739),re=n(5625);const ie=e=>{let{open:t,onClose:n,courseId:s,courseName:i,year:o,onSubscriptionSuccess:a}=e;const[c,d]=(0,r.useState)(""),[h,m]=(0,r.useState)(!1),[g,b]=(0,r.useState)(""),[A,j]=(0,r.useState)(""),[f,w]=(0,r.useState)(!1),S=async e=>{let t=0;const n=async()=>{try{const r=(await O.A.get("/api/subscription/status/".concat(e))).data.subscription;if("completed"===r.status)return j("\ud83c\udf89 Payment successful! Your premium subscription is now active."),void setTimeout(()=>{a(r),k()},2e3);if("failed"===r.status)return b("\u274c Payment failed. Please try again or check your M-Pesa balance."),void w(!1);if(t>12)try{const t=(await O.A.get("/api/subscription/query/".concat(e))).data.subscription;if("completed"===t.status)return j("\ud83c\udf89 Payment confirmed! Your premium subscription is now active."),void setTimeout(()=>{a(t),k()},2e3);if("failed"===t.status)return b("\u274c Payment failed. Please try again."),void w(!1)}catch(s){console.log("Direct M-Pesa query failed, continuing with regular polling")}t++,t<36?setTimeout(n,1e4):(b("\u23f0 Payment timeout. If you completed the payment, please wait a few minutes and refresh the page."),w(!1))}catch(r){console.error("Error checking payment status:",r),t++,t<36?setTimeout(n,1e4):(b("Unable to verify payment status. Please contact support if payment was deducted."),w(!1))}};setTimeout(n,3e3)},k=()=>{d(""),b(""),j(""),w(!1),m(!1),n()};return(0,G.jsxs)(I.A,{open:t,onClose:k,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[(0,G.jsxs)(X.A,{sx:{display:"flex",alignItems:"center",gap:2,bgcolor:"primary.main",color:"white"},children:[(0,G.jsx)(U.A,{}),(0,G.jsxs)(l.A,{children:[(0,G.jsx)(u.A,{variant:"h6",children:"Premium Subscription"}),(0,G.jsxs)(u.A,{variant:"caption",children:[i," - Year ",o]})]})]}),(0,G.jsxs)(C.A,{sx:{p:3},children:[g&&(0,G.jsx)(Q.A,{severity:"error",sx:{mb:2},children:g}),A&&(0,G.jsx)(Q.A,{severity:"success",sx:{mb:2},children:A}),f?(0,G.jsxs)(l.A,{sx:{textAlign:"center",py:4},children:[(0,G.jsx)(y.A,{size:60,sx:{mb:2}}),(0,G.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Processing Payment..."}),(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Please check your phone for M-Pesa prompt and enter your PIN"})]}):(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(l.A,{sx:{mb:3},children:[(0,G.jsxs)(u.A,{variant:"h5",sx:{fontWeight:"bold",mb:1},children:["KSH 100",(0,G.jsx)(u.A,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:"/ month"})]}),(0,G.jsx)(x.A,{label:"1 Month Access",color:"primary",size:"small",sx:{mb:2}}),(0,G.jsxs)(u.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Get premium access to Year ",o," content for ",i]})]}),(0,G.jsx)(v.A,{sx:{my:2}}),(0,G.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"What's Included:"}),(0,G.jsxs)(Z.A,{dense:!0,children:[(0,G.jsxs)($.Ay,{children:[(0,G.jsx)(ee.A,{children:(0,G.jsx)(P.A,{color:"primary"})}),(0,G.jsx)(te.A,{primary:"Premium Video Lectures",secondary:"Stream high-quality lecture recordings"})]}),(0,G.jsxs)($.Ay,{children:[(0,G.jsx)(ee.A,{children:(0,G.jsx)(E.A,{color:"primary"})}),(0,G.jsx)(te.A,{primary:"Downloadable Notes",secondary:"Download PDF notes for offline study"})]}),(0,G.jsxs)($.Ay,{children:[(0,G.jsx)(ee.A,{children:(0,G.jsx)(R.A,{color:"primary"})}),(0,G.jsx)(te.A,{primary:"CATs & Past Exams",secondary:"Access to premium assessment materials"})]}),(0,G.jsxs)($.Ay,{children:[(0,G.jsx)(ee.A,{children:(0,G.jsx)(M.A,{color:"success"})}),(0,G.jsx)(te.A,{primary:"Course-Specific Access",secondary:"Valid only for this course and year"})]})]}),(0,G.jsx)(v.A,{sx:{my:2}}),(0,G.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"M-Pesa Payment:"}),(0,G.jsx)(ne.A,{fullWidth:!0,label:"Phone Number",placeholder:"0712345678 or 254712345678",value:c,onChange:e=>d((e=>{const t=e.replace(/\D/g,"");return t.startsWith("254")?t:t.startsWith("0")?"254"+t.substring(1):t.startsWith("7")||t.startsWith("1")?"254"+t:t})(e.target.value)),helperText:"Enter your M-Pesa registered phone number",sx:{mb:2}}),(0,G.jsx)(Q.A,{severity:"info",sx:{mb:2},children:(0,G.jsx)(u.A,{variant:"body2",children:"You will receive an M-Pesa prompt on your phone. Enter your M-Pesa PIN to complete the payment."})})]})]}),(0,G.jsxs)(se.A,{sx:{p:3,pt:0},children:[(0,G.jsx)(p.A,{onClick:k,disabled:h,children:"Cancel"}),!f&&(0,G.jsx)(p.A,{variant:"contained",onClick:async()=>{if(!c||c.length<10)b("Please enter a valid phone number");else try{m(!0),b("");const e=await O.A.post("/api/subscription/initiate",{courseId:s,year:parseInt(o),phoneNumber:c.replace(/\D/g,"")});w(!0),j("Payment request sent! Please check your phone for M-Pesa prompt and enter your PIN to complete the payment."),S(e.data.subscription.id)}catch(n){var e,t;b((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Payment initiation failed")}finally{m(!1)}},disabled:h||!c,startIcon:h?(0,G.jsx)(y.A,{size:20}):(0,G.jsx)(re.A,{}),sx:{minWidth:120},children:h?"Processing...":"Pay KSH 100"})]})]})};var oe=n(6835);const ae=e=>{let{filename:t,contentType:n,title:s,backendUrl:i,preventScreenshot:o=!0,preventRecording:a=!0,onClose:c}=e;const d=(0,r.useRef)(null),[x,h]=(0,r.useState)(!1),[p,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>((o||a)&&g(),()=>{b()}),[o,a]);const g=()=>{const e=e=>(e.preventDefault(),v(),!1),t=e=>"PrintScreen"===e.key||e.altKey&&"PrintScreen"===e.key||e.metaKey&&e.shiftKey&&"S"===e.key||e.ctrlKey&&e.shiftKey&&"S"===e.key||"F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key||e.ctrlKey&&e.shiftKey&&"J"===e.key||e.ctrlKey&&"U"===e.key?(e.preventDefault(),v(),!1):void 0,n=()=>{document.hidden&&a?(d.current&&(d.current.style.filter="blur(20px)"),v("Screen recording detected! Content has been blurred for security.")):d.current&&(d.current.style.filter="none")};document.addEventListener("contextmenu",e),document.addEventListener("keydown",t),document.addEventListener("visibilitychange",n),d.current&&(d.current.style.userSelect="none",d.current.style.webkitUserSelect="none",d.current.style.mozUserSelect="none",d.current.style.msUserSelect="none"),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&v("Screen capture capabilities detected. Recording is prohibited."),window.securityCleanup=()=>{document.removeEventListener("contextmenu",e),document.removeEventListener("keydown",t),document.removeEventListener("visibilitychange",n)},h(!0)},b=()=>{window.securityCleanup&&(window.securityCleanup(),delete window.securityCleanup),h(!1)},v=e=>{if(!p){y(!0);alert("\ud83d\udd12 SECURITY NOTICE: ".concat(e||"Screenshots and screen recording are prohibited for this content.")),setTimeout(()=>y(!1),5e3)}},A=()=>{const e=localStorage.getItem("token");return"".concat(i,"/api/upload/file/").concat(t,"?token=").concat(encodeURIComponent(e))};return(0,G.jsxs)(l.A,{ref:d,sx:{position:"relative",width:"100%",height:"100%",minHeight:400,border:"2px solid #f44336",borderRadius:2,overflow:"hidden",bgcolor:"black","&::before":o?{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(244, 67, 54, 0.1) 10px, rgba(244, 67, 54, 0.1) 20px)",pointerEvents:"none",zIndex:10}:{}},children:[(0,G.jsxs)(l.A,{sx:{position:"absolute",top:0,left:0,right:0,bgcolor:"rgba(244, 67, 54, 0.9)",color:"white",p:1,display:"flex",alignItems:"center",justifyContent:"space-between",zIndex:20},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(N.A,{fontSize:"small"}),(0,G.jsx)(u.A,{variant:"caption",sx:{fontWeight:"bold"},children:"\ud83d\udd12 SECURE CONTENT - Screenshots & Recording Prohibited"})]}),c&&(0,G.jsx)(m.A,{size:"small",onClick:c,sx:{color:"white"},children:(0,G.jsx)(oe.A,{fontSize:"small"})})]}),(0,G.jsxs)(l.A,{sx:{pt:6,height:"100%"},children:["pdf"===n&&(0,G.jsx)("iframe",{src:A(),width:"100%",height:"100%",style:{border:"none",display:"block"},title:s,onContextMenu:e=>e.preventDefault()}),"image"===n&&(0,G.jsx)(l.A,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:2},children:(0,G.jsx)("img",{src:A(),alt:s,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onContextMenu:e=>e.preventDefault(),draggable:!1})})]}),(0,G.jsx)(l.A,{sx:{position:"absolute",bottom:10,right:10,bgcolor:"rgba(0, 0, 0, 0.7)",color:"white",p:1,borderRadius:1,fontSize:"0.75rem",zIndex:20,pointerEvents:"none"},children:"\ud83d\udd12 EduVault Secure View"}),x&&(0,G.jsx)(Q.A,{severity:"warning",sx:{position:"absolute",bottom:10,left:10,right:60,zIndex:20,fontSize:"0.75rem"},children:"This content is protected. Screenshots and screen recording are disabled."})]})};var le=n(8785),ce=n(8179),de=n(1543);const ue=e=>{let{type:t,id:n,onClose:i,open:c=!1}=e;const{user:d}=(0,de.A)(),[h,m]=(0,r.useState)(!0),[g,b]=(0,r.useState)(null),[A,j]=(0,r.useState)(""),[f,w]=(0,r.useState)(""),[S,k]=(0,r.useState)(!1),[P,E]=(0,r.useState)(0),[R,D]=(0,r.useState)(""),[W,z]=(0,r.useState)(!1),L=((0,r.useRef)(null),(0,r.useRef)(null)),U=(0,r.useRef)(null);(0,r.useEffect)(()=>(c&&t&&n&&(T(),M()),()=>{K()}),[t,n,c]),(0,r.useEffect)(()=>(S&&P>0&&(L.current=setInterval(()=>{E(e=>e<=1?(F(),0):e-1)},1e3)),()=>{L.current&&clearInterval(L.current)}),[S,P]);const T=async()=>{try{m(!0),w(""),console.log("\ud83d\udd0d SecureImageViewer - Fetching assessment:",{type:t,id:n});const e=await O.A.get("/api/secure-images/metadata/".concat(t,"/").concat(n));e.data.success?(b(e.data.data),E(60*e.data.data.duration)):w("Assessment not found or access denied")}catch(f){console.error("Error fetching assessment:",f),w("Failed to load assessment. Please check your connection and try again.")}finally{m(!1)}},M=()=>{const e=e=>{e.preventDefault(),B("Right-click is disabled for security reasons")},t=e=>"PrintScreen"===e.key||e.altKey&&"PrintScreen"===e.key||e.metaKey&&"PrintScreen"===e.key||e.ctrlKey&&"PrintScreen"===e.key?(e.preventDefault(),B("Screenshots are not allowed during assessment viewing"),!1):"F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key||e.ctrlKey&&e.shiftKey&&"J"===e.key?(e.preventDefault(),B("Developer tools are disabled for security"),!1):e.ctrlKey&&"u"===e.key?(e.preventDefault(),B("View source is disabled for security"),!1):e.ctrlKey&&"s"===e.key?(e.preventDefault(),B("Saving is not allowed during assessment"),!1):e.ctrlKey&&"a"===e.key?(e.preventDefault(),B("Text selection is disabled for security"),!1):e.ctrlKey&&"c"===e.key?(e.preventDefault(),B("Copying is not allowed during assessment"),!1):void 0,n=e=>{e.preventDefault(),B("Drag and drop is disabled for security")},s=e=>{e.preventDefault()};document.addEventListener("contextmenu",e),document.addEventListener("keydown",t),document.addEventListener("dragstart",n),document.addEventListener("selectstart",s),window.securityListeners={handleContextMenu:e,handleKeyDown:t,handleDragStart:n,handleSelectStart:s};const r=()=>{S&&B("Please stay focused on the assessment window")},i=()=>{document.hidden&&S&&B("Assessment paused - window is not visible")};window.addEventListener("blur",r),document.addEventListener("visibilitychange",i),window.securityListeners.handleBlur=r,window.securityListeners.handleVisibilityChange=i;let o={open:!1,orientation:null};setInterval(()=>{window.outerHeight-window.innerHeight>160||window.outerWidth-window.innerWidth>160?o.open||(o.open=!0,B("Developer tools detected - please close them")):o.open=!1},500)},K=()=>{if(window.securityListeners){const{handleContextMenu:e,handleKeyDown:t,handleDragStart:n,handleSelectStart:s,handleBlur:r,handleVisibilityChange:i}=window.securityListeners;document.removeEventListener("contextmenu",e),document.removeEventListener("keydown",t),document.removeEventListener("dragstart",n),document.removeEventListener("selectstart",s),window.removeEventListener("blur",r),document.removeEventListener("visibilitychange",i),delete window.securityListeners}L.current&&clearInterval(L.current),A&&A.startsWith("blob:")&&URL.revokeObjectURL(A)},B=e=>{D(e),z(!0)},F=()=>{B("\u23f0 Time is up! The assessment viewing session has ended."),setTimeout(()=>{_()},3e3)},_=async()=>{try{await O.A.post("/api/secure-images/log-access",{assessmentId:n,assessmentType:t,action:"end_viewing",timestamp:(new Date).toISOString()})}catch(f){console.error("Error logging end of session:",f)}K(),k(!1),j(""),i&&i()};return c?h?(0,G.jsx)(I.A,{open:!0,maxWidth:"md",fullWidth:!0,children:(0,G.jsx)(C.A,{children:(0,G.jsxs)(l.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:[(0,G.jsx)(y.A,{}),(0,G.jsx)(u.A,{sx:{ml:2},children:"Loading secure assessment..."})]})})}):f?(0,G.jsxs)(I.A,{open:!0,maxWidth:"sm",fullWidth:!0,children:[(0,G.jsx)(X.A,{children:"Error"}),(0,G.jsx)(C.A,{children:(0,G.jsx)(Q.A,{severity:"error",children:f})}),(0,G.jsx)(se.A,{children:(0,G.jsx)(p.A,{onClick:i,children:"Close"})})]}):(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(I.A,{open:!0,maxWidth:"lg",fullWidth:!0,fullScreen:S,onClose:S?void 0:i,disableEscapeKeyDown:S,PaperProps:{sx:(0,s.A)({},S&&{bgcolor:"black",color:"white"})},children:[(0,G.jsxs)(X.A,{sx:{bgcolor:S?"rgba(0,0,0,0.9)":"error.light",color:S?"white":"error.dark",display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(N.A,{}),"\ud83d\udd12 Secure Assessment Viewer",S&&(0,G.jsx)(x.A,{label:"Time: ".concat((e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=e%60;return t>0?"".concat(t,":").concat(n.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0")):"".concat(n,":").concat(s.toString().padStart(2,"0"))})(P)),color:P<300?"error":"primary",sx:{ml:"auto"}}),S&&(0,G.jsx)(p.A,{variant:"contained",color:"error",onClick:_,size:"small",startIcon:(0,G.jsx)(oe.A,{}),children:"End Session"})]}),(0,G.jsx)(C.A,{sx:{p:0},children:S?(0,G.jsxs)(l.A,{sx:{height:"100vh",display:"flex",flexDirection:"column",bgcolor:"black",position:"relative",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},children:[(0,G.jsx)(l.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3,background:"\n                  repeating-linear-gradient(\n                    45deg,\n                    transparent,\n                    transparent 10px,\n                    rgba(255,0,0,0.05) 10px,\n                    rgba(255,0,0,0.05) 11px\n                  )\n                "}}),(0,G.jsx)(l.A,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",p:2,userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},children:A?(0,G.jsx)("img",{ref:U,src:A,alt:"Assessment",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",pointerEvents:"none",WebkitUserDrag:"none",WebkitTouchCallout:"none",filter:"contrast(1.1) brightness(0.95)"},onDragStart:e=>e.preventDefault(),onContextMenu:e=>e.preventDefault(),onLoad:()=>{U.current&&(U.current.style.webkitUserSelect="none",U.current.style.webkitTouchCallout="none")}}):(0,G.jsx)(y.A,{color:"primary"})}),(0,G.jsxs)(l.A,{sx:{position:"absolute",bottom:20,right:20,color:"rgba(255,255,255,0.3)",fontSize:"12px",zIndex:1001,pointerEvents:"none"},children:["\ud83d\udd12 Secure View - ",null===d||void 0===d?void 0:d.firstName," ",null===d||void 0===d?void 0:d.lastName," - ",(new Date).toLocaleString()]}),(0,G.jsx)(l.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"rgba(255,255,255,0.1)",fontSize:"48px",zIndex:999,pointerEvents:"none",fontWeight:"bold"},children:"EDUVAULT"})]}):(0,G.jsxs)(l.A,{sx:{p:3},children:[(0,G.jsx)(o.A,{variant:"outlined",sx:{mb:3},children:(0,G.jsxs)(a.A,{children:[(0,G.jsx)(u.A,{variant:"h5",gutterBottom:!0,children:null===g||void 0===g?void 0:g.title}),(0,G.jsxs)(u.A,{variant:"subtitle1",color:"text.secondary",gutterBottom:!0,children:["\ud83d\udcda ",null===g||void 0===g?void 0:g.unitName]}),(null===g||void 0===g?void 0:g.course)&&(0,G.jsxs)(u.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:["Course: ",g.course.code," - ",g.course.name]}),(0,G.jsx)(u.A,{variant:"body1",sx:{mb:2},children:null===g||void 0===g?void 0:g.description}),(0,G.jsx)(v.A,{sx:{my:2}}),(0,G.jsxs)(l.A,{sx:{display:"flex",gap:4,mb:2,flexWrap:"wrap"},children:[(0,G.jsxs)(u.A,{variant:"body2",children:[(0,G.jsx)("strong",{children:"\ud83d\udcca Total Marks:"})," ",null===g||void 0===g?void 0:g.totalMarks]}),(0,G.jsxs)(u.A,{variant:"body2",children:[(0,G.jsx)("strong",{children:"\u23f1\ufe0f Duration:"})," ",null===g||void 0===g?void 0:g.duration," minutes"]}),(0,G.jsxs)(u.A,{variant:"body2",children:[(0,G.jsx)("strong",{children:"\ud83d\udcc5 Due:"})," ",(V=null===g||void 0===g?void 0:g.dueDate,new Date(V).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]}),(null===g||void 0===g?void 0:g.instructions)&&(0,G.jsxs)(l.A,{sx:{mt:2},children:[(0,G.jsx)(u.A,{variant:"subtitle2",gutterBottom:!0,children:"\ud83d\udccb Instructions:"}),(0,G.jsx)(u.A,{variant:"body2",sx:{p:2,bgcolor:"grey.50",borderRadius:1,border:1,borderColor:"grey.200"},children:g.instructions})]})]})}),(0,G.jsxs)(Q.A,{severity:"warning",sx:{mb:3},children:[(0,G.jsx)(u.A,{variant:"subtitle2",gutterBottom:!0,children:"\ud83d\udd12 Security Notice:"}),(0,G.jsxs)(u.A,{variant:"body2",children:["\u2022 Screenshots and screen recording are disabled",(0,G.jsx)("br",{}),"\u2022 Right-click and developer tools are blocked",(0,G.jsx)("br",{}),"\u2022 Switching tabs or windows will trigger warnings",(0,G.jsx)("br",{}),"\u2022 Your viewing session is being monitored",(0,G.jsx)("br",{}),"\u2022 Time limit will be strictly enforced",(0,G.jsx)("br",{}),"\u2022 Copying and saving are disabled"]})]}),(0,G.jsx)(Q.A,{severity:"info",children:(0,G.jsxs)(u.A,{variant:"body2",children:[(0,G.jsx)("strong",{children:"Ready to start?"})," Once you begin viewing, the timer will start and security measures will be activated. Make sure you're in a quiet environment and won't be interrupted."]})})]})}),!S&&(0,G.jsxs)(se.A,{sx:{p:3},children:[(0,G.jsx)(p.A,{onClick:i,color:"inherit",children:"Cancel"}),(0,G.jsx)(p.A,{onClick:async()=>{try{m(!0);const e=(await O.A.get("/api/secure-images/".concat(t,"/").concat(n),{responseType:"blob"})).data,s=URL.createObjectURL(e);j(s),k(!0),await O.A.post("/api/secure-images/log-access",{assessmentId:n,assessmentType:t,action:"start_viewing",timestamp:(new Date).toISOString()})}catch(f){console.error("Error loading secure image:",f),w("Failed to load assessment image. Please try again or contact support.")}finally{m(!1)}},variant:"contained",startIcon:(0,G.jsx)(ce.A,{}),color:"primary",disabled:h||!(null!==g&&void 0!==g&&g.hasFile),children:"Start Secure Viewing"})]})]}),(0,G.jsx)(le.A,{open:W,autoHideDuration:4e3,onClose:()=>z(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,G.jsx)(Q.A,{onClose:()=>z(!1),severity:"error",sx:{width:"100%"},icon:(0,G.jsx)(N.A,{}),children:R})})]}):null;var V},xe=()=>{var e,t,n;const[X,Q]=(0,r.useState)(null),[Z,$]=(0,r.useState)([]),[ee,te]=(0,r.useState)(!0),[ne,se]=(0,r.useState)(0),[re,oe]=(0,r.useState)(1),[le,ce]=(0,r.useState)({}),[de,xe]=(0,r.useState)(null),[he,pe]=(0,r.useState)(null),[me,ye]=(0,r.useState)(null),[ge,be]=(0,r.useState)({}),[ve,Ae]=(0,r.useState)(!1),[je,fe]=(0,r.useState)(1),[we,Se]=(0,r.useState)(!1),[ke,Ie]=(0,r.useState)(null),[Ce,Pe]=(0,r.useState)(!1),[Ee,Re]=(0,r.useState)(null),{id:De}=(0,q.g)(),We=(0,i.A)();(0,r.useEffect)(()=>{ze()},[De]);const ze=async()=>{try{te(!0);const t=await O.A.get("/api/courses/".concat(De));Q(t.data.course);try{const e=await O.A.get("/api/student/course/".concat(De,"/content"));$(e.data.content||[]),ce(e.data.subscriptions||{}),xe(e.data.subscriptionInfo),console.log("\ud83d\udcda Loaded approved content:",e.data)}catch(e){console.log("No approved content found for this course"),$([])}}catch(he){console.error("Error fetching course data:",he),pe("Failed to load course data. Please try again later."),Q(null),$([])}finally{te(!1)}},Le=e=>{switch(e){case"video":return(0,G.jsx)(P.A,{});case"notes":default:return(0,G.jsx)(E.A,{});case"cats":return(0,G.jsx)(R.A,{});case"assignments":return(0,G.jsx)(D.A,{});case"pastExams":return(0,G.jsx)(W.A,{});case"youtube":return(0,G.jsx)(z.A,{})}},Ue=e=>{switch(e){case"video":return We.palette.primary.main;case"notes":return We.palette.secondary.main;case"cats":return We.palette.warning.main;case"assignments":return We.palette.success.main;case"pastExams":return We.palette.info.main;case"youtube":return"#ff0000";default:return We.palette.grey[500]}},Te=e=>{switch(e){case"video":return"Lecture Video";case"notes":return"PDF Notes";case"cats":return"CAT";case"assignments":return"Assignment";case"pastExams":return"Past Exam";case"youtube":return"YouTube Video";default:return e}},Ne=e=>{var t,n,s;return null!==(t=null!==(n=null===(s=e.unit)||void 0===s?void 0:s.year)&&void 0!==n?n:e.unitYear)&&void 0!==t?t:e.year},Me=(e,t)=>Z.filter(n=>{const s=(e=>{var t,n,s;return(null===(t=e.unit)||void 0===t?void 0:t._id)||(null===(n=e.unit)||void 0===n?void 0:n.id)||e.unitId||(null===(s=e.unit)||void 0===s?void 0:s.unitId)})(n);return Ne(n)===t&&s===e}),Ke=e=>le[e]||!1,Be=e=>{fe(e),Ae(!0)},Fe=e=>{if(console.log("\ud83d\udd0d CoursePage - handleSecureImageView called with:",e),["cats","pastExams"].includes(e.type)){let t=e._id||e.id||"507f1f77bcf86cd799439011";"string"!==typeof t||!t.includes("-")&&24===t.length||(t="507f1f77bcf86cd799439011");const n=(0,s.A)((0,s.A)({},e),{},{_id:t,id:t});console.log("\ud83d\udd27 Using cleaned ID:",t),Re(n),Pe(!0)}},_e=e=>{var t,n;if(null!==(t=e.accessRules)&&void 0!==t&&t.downloadRequiresSubscription&&!Ke(e.unit.year))Be(e.unit.year);else if(null!==(n=e.accessRules)&&void 0!==n&&n.canDownload){const t="".concat("https://eduvault-exms.onrender.com","/api/upload/file/").concat(e.filename);window.open(t,"_blank")}};return ee?(0,G.jsx)(l.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,G.jsx)(y.A,{})}):(0,G.jsxs)(l.A,{children:[(0,G.jsx)(l.A,{sx:{background:"linear-gradient(135deg, ".concat(We.palette.primary.main," 0%, ").concat(We.palette.primary.dark," 100%)"),color:"white",py:6,position:"relative",overflow:"hidden"},children:(0,G.jsx)(g.A,{maxWidth:"lg",children:(0,G.jsx)(H.P.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:(0,G.jsxs)(b.Ay,{container:!0,spacing:4,alignItems:"center",children:[(0,G.jsxs)(b.Ay,{item:!0,xs:12,md:8,children:[(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,G.jsx)(c.A,{sx:{width:70,height:70,bgcolor:"rgba(255,255,255,0.2)",mr:3},children:(0,G.jsx)(W.A,{sx:{fontSize:35}})}),(0,G.jsxs)(l.A,{children:[(0,G.jsx)(u.A,{variant:"h3",component:"h1",sx:{fontWeight:700,mb:1},children:null===X||void 0===X?void 0:X.name}),(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,G.jsx)(x.A,{label:null===X||void 0===X?void 0:X.code,sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white",fontWeight:600}}),(0,G.jsx)(x.A,{label:null===X||void 0===X?void 0:X.department,sx:{bgcolor:We.palette.secondary.main,color:"white",fontWeight:600}})]})]})]}),(0,G.jsx)(u.A,{variant:"h6",sx:{mb:3,opacity:.9,lineHeight:1.6},children:null===X||void 0===X?void 0:X.description}),(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:3,mb:3},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(B.A,{sx:{fontSize:20}}),(0,G.jsxs)(u.A,{variant:"body1",children:[null===X||void 0===X?void 0:X.duration.years," Years"]})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(F.A,{sx:{fontSize:20}}),(0,G.jsxs)(u.A,{variant:"body1",children:[null===X||void 0===X?void 0:X.totalStudents," Students"]})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(U.A,{sx:{fontSize:20,color:"#ffc107"}}),(0,G.jsxs)(u.A,{variant:"body1",children:[null===X||void 0===X?void 0:X.rating," Rating"]})]})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",gap:2},children:[(0,G.jsx)(p.A,{variant:"contained",size:"large",startIcon:(0,G.jsx)(_.A,{}),sx:{bgcolor:We.palette.secondary.main,"&:hover":{bgcolor:We.palette.secondary.dark}},children:"Start Learning"}),(0,G.jsx)(m.A,{sx:{color:"white"},children:(0,G.jsx)(K.A,{})}),(0,G.jsx)(m.A,{sx:{color:"white"},children:(0,G.jsx)(V.A,{})})]})]}),(0,G.jsx)(b.Ay,{item:!0,xs:12,md:4,children:(0,G.jsxs)(h.A,{elevation:8,sx:{p:3,bgcolor:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",borderRadius:3},children:[(0,G.jsx)(u.A,{variant:"h6",color:"primary",gutterBottom:!0,sx:{fontWeight:600},children:"Course Progress"}),(0,G.jsx)(v.A,{sx:{mb:2}}),(0,G.jsxs)(l.A,{sx:{mb:3},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Completion"}),(0,G.jsxs)(u.A,{variant:"body2",sx:{fontWeight:600},children:[null===X||void 0===X?void 0:X.completionRate,"%"]})]}),(0,G.jsx)(A.A,{variant:"determinate",value:(null===X||void 0===X?void 0:X.completionRate)||0,sx:{height:8,borderRadius:4}})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Resources"}),(0,G.jsx)(u.A,{variant:"body2",sx:{fontWeight:600},children:Z.length})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Institution"}),(0,G.jsx)(u.A,{variant:"body2",sx:{fontWeight:600},children:(null===X||void 0===X||null===(e=X.institution)||void 0===e?void 0:e.shortName)||(null===X||void 0===X||null===(t=X.institution)||void 0===t?void 0:t.name)||"N/A"})]})]})})]})})})}),(0,G.jsxs)(g.A,{maxWidth:"lg",sx:{py:6},children:[(0,G.jsxs)(l.A,{sx:{mb:4},children:[(0,G.jsx)(u.A,{variant:"h4",component:"h2",gutterBottom:!0,sx:{fontWeight:600,mb:3},children:"Course Content"}),(0,G.jsx)(l.A,{sx:{display:"flex",gap:2,mb:4,flexWrap:"wrap"},children:Array.from({length:(null===X||void 0===X||null===(n=X.duration)||void 0===n?void 0:n.years)||3},(e,t)=>t+1).map(e=>(0,G.jsxs)(p.A,{variant:re===e?"contained":"outlined",onClick:()=>(e=>{oe(e),ye(null),be({})})(e),sx:{minWidth:120,py:1.5,fontWeight:600,borderRadius:3},children:["Year ",e]},e))})]}),(0,G.jsxs)(l.A,{sx:{mb:6},children:[(0,G.jsxs)(u.A,{variant:"h5",component:"h3",gutterBottom:!0,sx:{fontWeight:600,mb:3},children:["Course Units - Year ",re]}),null!==X&&void 0!==X&&X.units&&X.units.length>0?(0,G.jsx)(b.Ay,{container:!0,spacing:2,children:[1,2].map(e=>{const t=X.units.filter(t=>t.year===re&&t.semester===e);return(0,G.jsx)(b.Ay,{item:!0,xs:12,md:6,children:(0,G.jsxs)(h.A,{sx:{p:3},children:[(0,G.jsxs)(u.A,{variant:"h6",color:"primary",gutterBottom:!0,children:["Semester ",e]}),0===t.length?(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"No units available for this semester"}):(0,G.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:t.map(e=>{const t=e._id||e.id,n=(e=>me===e)(t),r=Me(t,e.year),i=((e,t)=>{var n,s;const r=Me(e,t),i=new Map;r.forEach(e=>{const t=e.topic||{},n=t.number,s=t.title||(null!=n?"Topic ".concat(n):"General Resources"),r=t.description,o=t._id||t.id||(null!=n?"topic-".concat(n):"general");i.has(o)||i.set(o,{key:o,number:n,title:s,description:r,resources:[]}),i.get(o).resources.push(e)});const o=null===X||void 0===X||null===(n=X.units)||void 0===n?void 0:n.find(n=>(n._id||n.id)===e&&n.year===t);return null!==o&&void 0!==o&&null!==(s=o.topics)&&void 0!==s&&s.length&&o.topics.forEach(e=>{const t=e._id||e.id||(null!=e.topicNumber?"topic-".concat(e.topicNumber):"topic-".concat(e.title));i.has(t)||i.set(t,{key:t,number:e.topicNumber,title:e.title||(null!=e.topicNumber?"Topic ".concat(e.topicNumber):"Untitled Topic"),description:e.description,resources:[]})}),Array.from(i.values()).sort((e,t)=>{var n,s;const r=null!==(n=e.number)&&void 0!==n?n:Number.POSITIVE_INFINITY,i=null!==(s=t.number)&&void 0!==s?s:Number.POSITIVE_INFINITY;return r!==i?r-i:e.title.localeCompare(t.title)})})(t,e.year),y=r.length>0,g=i.length>0;return(0,G.jsxs)(o.A,{variant:"outlined",sx:{borderColor:n?We.palette.primary.main:void 0,boxShadow:n?"0 0 0 2px rgba(33,150,243,0.15)":void 0},children:[(0,G.jsx)(j.A,{onClick:()=>(e=>{const t=e._id||e.id;ye(e=>e===t?(be(e=>{if(!e[t])return e;const n=(0,s.A)({},e);return delete n[t],n}),null):t),e.year!==re&&oe(e.year)})(e),sx:{alignItems:"stretch"},children:(0,G.jsxs)(a.A,{sx:{p:2},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,G.jsx)(u.A,{variant:"subtitle1",sx:{fontWeight:600},children:e.unitCode}),(0,G.jsxs)(l.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,G.jsx)(x.A,{label:"".concat(e.creditHours," CH"),size:"small",color:"primary"}),(0,G.jsx)(x.A,{label:"".concat(r.length," ").concat(1===r.length?"Resource":"Resources"),size:"small",variant:"outlined"})]})]}),(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.unitName}),e.description&&(0,G.jsx)(u.A,{variant:"body2",sx:{mt:1},children:e.description}),e.prerequisites&&e.prerequisites.length>0&&(0,G.jsx)(l.A,{sx:{mt:1},children:(0,G.jsxs)(u.A,{variant:"caption",color:"warning.main",children:["Prerequisites: ",e.prerequisites.join(", ")]})}),(0,G.jsx)(u.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:2},children:n?"Tap to collapse resources":"Tap to view learning resources"})]})}),(0,G.jsxs)(f.A,{in:n,timeout:"auto",unmountOnExit:!0,children:[(0,G.jsx)(v.A,{}),(0,G.jsxs)(a.A,{sx:{pt:3,bgcolor:"grey.50"},children:[(0,G.jsx)(u.A,{variant:"subtitle2",sx:{fontWeight:600,mb:2},children:"Learning Resources"}),y||g?(0,G.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:g?i.map(e=>{const n=((e,t)=>ge[e]===t)(t,e.key);return(0,G.jsxs)(o.A,{variant:"outlined",sx:{overflow:"hidden"},children:[(0,G.jsx)(j.A,{onClick:()=>((e,t)=>{const n=ge[e]===t;be(r=>(0,s.A)((0,s.A)({},r),{},{[e]:n?null:t})),n||requestAnimationFrame(()=>{const n=document.getElementById("topic-panel-".concat(e,"-").concat(t));n&&n.scrollIntoView({behavior:"smooth",block:"start"})})})(t,e.key),children:(0,G.jsx)(a.A,{sx:{backgroundColor:"background.default"},children:(0,G.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,G.jsxs)(l.A,{children:[(0,G.jsx)(u.A,{variant:"subtitle1",sx:{fontWeight:600},children:null!=e.number?"Topic ".concat(e.number,": ").concat(e.title):e.title}),e.description&&(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:e.description})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(x.A,{label:"".concat(e.resources.length," ").concat(1===e.resources.length?"Resource":"Resources"),size:"small",color:"primary",variant:"outlined"}),(0,G.jsx)(Y.A,{sx:{transform:n?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease"}})]})]})})}),(0,G.jsx)(f.A,{in:n,timeout:"auto",unmountOnExit:!0,children:(0,G.jsx)(l.A,{id:"topic-panel-".concat(t,"-").concat(e.key),sx:{p:3,pt:0,display:"flex",flexDirection:"column",gap:2},children:e.resources.length>0?e.resources.map(e=>(e=>{var t;const n=Ne(e),s=(e=>{var t,n,s;return null!==(t=null!==(n=null===(s=e.unit)||void 0===s?void 0:s.semester)&&void 0!==n?n:e.unitSemester)&&void 0!==t?t:e.semester})(e);return(0,G.jsx)(H.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},children:(0,G.jsx)(o.A,{variant:"outlined",sx:{overflow:"hidden",border:e.isPremium?"2px solid #ffa726":"1px solid #e0e0e0"},children:(0,G.jsxs)(a.A,{sx:{p:0},children:[(0,G.jsxs)(l.A,{sx:{p:3,pb:2},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"flex-start",mb:2},children:[(0,G.jsx)(c.A,{sx:{bgcolor:(0,d.X4)(Ue(e.type),.1),color:Ue(e.type),width:50,height:50,mr:2},children:Le(e.type)}),(0,G.jsxs)(l.A,{sx:{flexGrow:1},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,G.jsx)(u.A,{variant:"h6",component:"h3",sx:{fontWeight:600},children:e.title}),e.isPremium&&(0,G.jsx)(x.A,{label:"PREMIUM",size:"small",color:"warning",icon:(0,G.jsx)(L.A,{})})]}),(0,G.jsxs)(u.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Semester ",s]}),e.topic&&(0,G.jsxs)(u.A,{variant:"caption",color:"text.secondary",children:["Topic ",e.topic.number,": ",e.topic.title]})]})]}),(0,G.jsxs)(l.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,G.jsx)(x.A,{label:Te(e.type),size:"small",sx:{bgcolor:(0,d.X4)(Ue(e.type),.1),color:Ue(e.type),fontWeight:600}}),e.duration&&(0,G.jsx)(x.A,{label:e.duration,size:"small",variant:"outlined"}),e.fileSize&&(0,G.jsx)(x.A,{label:"".concat((e.fileSize/1024/1024).toFixed(1)," MB"),size:"small",variant:"outlined"})]}),e.description&&(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description})]}),"video"===e.type&&e.hasAccess&&e.filename&&(0,G.jsx)(l.A,{sx:{px:3,pb:3},children:(0,G.jsx)(J,{filename:e.filename,backendUrl:"https://eduvault-exms.onrender.com",isPremium:e.isPremium,hasSubscription:Ke(n)})}),"video"===e.type&&!e.hasAccess&&(0,G.jsx)(l.A,{sx:{px:3,pb:3},children:(0,G.jsxs)(h.A,{sx:{p:4,textAlign:"center",bgcolor:"grey.100",border:"2px dashed #ffa726"},children:[(0,G.jsx)(L.A,{sx:{fontSize:48,color:"warning.main",mb:2}}),(0,G.jsx)(u.A,{variant:"subtitle1",gutterBottom:!0,children:"Premium Content"}),(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Subscribe to access this video lecture"}),(0,G.jsxs)(p.A,{variant:"contained",color:"warning",onClick:()=>Be(n),startIcon:(0,G.jsx)(U.A,{}),children:["Subscribe for KSH ",(null===de||void 0===de?void 0:de.price)||100]})]})}),(0,G.jsxs)(l.A,{sx:{p:3,pt:0,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[(0,G.jsxs)(l.A,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:["notes"===e.type&&e.filename&&(null!==(t=e.accessRules)&&void 0!==t&&t.canDownload?(0,G.jsx)(p.A,{variant:"contained",size:"small",startIcon:(0,G.jsx)(T.A,{}),onClick:()=>_e(e),sx:{borderRadius:2},children:"Download PDF"}):(0,G.jsx)(p.A,{variant:"outlined",size:"small",startIcon:(0,G.jsx)(L.A,{}),onClick:()=>Be(n),sx:{borderRadius:2},children:"Subscribe to Download"})),"youtube"===e.type&&e.url&&e.hasAccess&&(0,G.jsx)(p.A,{variant:"contained",size:"small",startIcon:(0,G.jsx)(z.A,{}),href:e.url,target:"_blank",sx:{borderRadius:2},children:"Watch on YouTube"}),"assignments"===e.type&&e.filename&&(0,G.jsx)(p.A,{variant:"contained",size:"small",startIcon:(0,G.jsx)(D.A,{}),href:"".concat("https://eduvault-exms.onrender.com","/api/upload/file/").concat(e.filename),target:"_blank",sx:{borderRadius:2,bgcolor:"success.main"},children:"Download Assignment (Free)"}),["cats","pastExams"].includes(e.type)&&e.filename&&(e.hasAccess?(0,G.jsxs)(p.A,{variant:"contained",size:"small",startIcon:(0,G.jsx)(N.A,{}),onClick:()=>Fe(e),sx:{borderRadius:2,bgcolor:"warning.main"},children:["\ud83d\udd12 View ",Te(e.type)," (Secure)"]}):(0,G.jsx)(p.A,{variant:"outlined",size:"small",startIcon:(0,G.jsx)(L.A,{}),onClick:()=>Be(n),sx:{borderRadius:2},children:"Subscribe to Access"})),Ke(n)&&(0,G.jsx)(x.A,{label:"Premium Active",color:"success",size:"small",icon:(0,G.jsx)(M.A,{})}),(0,G.jsx)(m.A,{size:"small",children:(0,G.jsx)(K.A,{})})]}),(0,G.jsxs)(u.A,{variant:"caption",color:"text.secondary",children:["Uploaded: ",new Date(e.uploadDate).toLocaleDateString()]})]})]})})},e._id||e.id)})(e)):(0,G.jsx)(h.A,{sx:{p:2,textAlign:"center",bgcolor:"background.paper"},children:(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Content for this topic is coming soon."})})})})]},e.key)}):(0,G.jsx)(h.A,{sx:{p:3,textAlign:"center",bgcolor:"background.paper"},children:(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Resources will appear here once they are approved."})})}):(0,G.jsx)(h.A,{sx:{p:3,textAlign:"center",bgcolor:"background.paper"},children:(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"No topics or resources have been published for this unit yet."})})]})]})]},t)})})]})},e)})}):(0,G.jsxs)(h.A,{sx:{p:4,textAlign:"center"},children:[(0,G.jsxs)(u.A,{variant:"h6",color:"text.secondary",children:["No units available for Year ",re," yet."]}),(0,G.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Units will appear here once they are added by administrators."})]})]}),(0,G.jsxs)(l.A,{sx:{mt:6},children:[(0,G.jsx)(u.A,{variant:"h5",component:"h2",gutterBottom:!0,sx:{fontWeight:600,mb:3},children:"Course Information"}),(null===X||void 0===X?void 0:X.entryRequirements)&&(0,G.jsxs)(w.A,{children:[(0,G.jsx)(S.A,{expandIcon:(0,G.jsx)(Y.A,{}),children:(0,G.jsx)(u.A,{variant:"h6",sx:{fontWeight:600},children:"Entry Requirements"})}),(0,G.jsx)(k.A,{children:(0,G.jsx)(u.A,{variant:"body2",children:X.entryRequirements})})]}),(null===X||void 0===X?void 0:X.careerProspects)&&X.careerProspects.length>0&&(0,G.jsxs)(w.A,{children:[(0,G.jsx)(S.A,{expandIcon:(0,G.jsx)(Y.A,{}),children:(0,G.jsx)(u.A,{variant:"h6",sx:{fontWeight:600},children:"Career Prospects"})}),(0,G.jsx)(k.A,{children:(0,G.jsx)(l.A,{component:"ul",sx:{pl:2},children:X.careerProspects.map((e,t)=>(0,G.jsx)(l.A,{component:"li",sx:{mb:1},children:(0,G.jsx)(u.A,{variant:"body2",children:e})},t))})})]}),(null===X||void 0===X?void 0:X.description)&&(0,G.jsxs)(w.A,{children:[(0,G.jsx)(S.A,{expandIcon:(0,G.jsx)(Y.A,{}),children:(0,G.jsx)(u.A,{variant:"h6",sx:{fontWeight:600},children:"Course Description"})}),(0,G.jsx)(k.A,{children:(0,G.jsx)(u.A,{variant:"body2",children:X.description})})]})]})]}),(0,G.jsx)(ie,{open:ve,onClose:()=>Ae(!1),courseId:De,courseName:null===X||void 0===X?void 0:X.name,year:je,onSubscriptionSuccess:e=>{ce(t=>(0,s.A)((0,s.A)({},t),{},{[e.year]:!0})),ze()}}),(0,G.jsx)(I.A,{open:we,onClose:()=>Se(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh"}},children:(0,G.jsx)(C.A,{sx:{p:0},children:ke&&(0,G.jsx)(ae,{filename:ke.filename,contentType:"cats"===ke.type||"pastExams"===ke.type?"pdf":"image",title:ke.title,backendUrl:"https://eduvault-exms.onrender.com",preventScreenshot:!0,preventRecording:!0,onClose:()=>Se(!1)})})}),Ee&&(0,G.jsx)(ue,{type:Ee.type,id:Ee._id||Ee.id,open:Ce,onClose:()=>{Pe(!1),Re(null)}})]})}}}]);